var qq=function(e){"use strict";return{hide:function(){e.style.display="none";return this},attach:function(t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}return function(){qq(e).detach(t,n)}},detach:function(t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}else if(e.attachEvent){e.detachEvent("on"+t,n)}return this},contains:function(t){if(!t){return false}if(e===t){return true}if(e.contains){return e.contains(t)}else{return!!(t.compareDocumentPosition(e)&8)}},insertBefore:function(t){t.parentNode.insertBefore(e,t);return this},remove:function(){e.parentNode.removeChild(e);return this},css:function(t){if(e.style==null){throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!")}if(t.opacity!=null){if(typeof e.style.opacity!=="string"&&typeof e.filters!=="undefined"){t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"}}qq.extend(e.style,t);return this},hasClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return n.test(e.className)},addClass:function(t){if(!qq(e).hasClass(t)){e.className+=" "+t}return this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(t){var n,r=[];if(e.querySelectorAll){return e.querySelectorAll("."+t)}n=e.getElementsByTagName("*");qq.each(n,function(e,n){if(qq(n).hasClass(t)){r.push(n)}});return r},children:function(){var t=[],n=e.firstChild;while(n){if(n.nodeType===1){t.push(n)}n=n.nextSibling}return t},setText:function(t){e.innerText=t;e.textContent=t;return this},clearText:function(){return qq(e).setText("")},hasAttribute:function(t){var n;if(e.hasAttribute){if(!e.hasAttribute(t)){return false}return/^false$/i.exec(e.getAttribute(t))==null}else{n=e[t];if(n===undefined){return false}return/^false$/i.exec(n)==null}}}};(function(){"use strict";qq.log=function(e,t){if(window.console){if(!t||t==="info"){window.console.log(e)}else{if(window.console[t]){window.console[t](e)}else{window.console.log("<"+t+"> "+e)}}}};qq.isObject=function(e){return e&&!e.nodeType&&Object.prototype.toString.call(e)==="[object Object]"};qq.isFunction=function(e){return typeof e==="function"};qq.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer};qq.isItemList=function(e){return Object.prototype.toString.call(e)==="[object DataTransferItemList]"};qq.isNodeList=function(e){return Object.prototype.toString.call(e)==="[object NodeList]"||e.item&&e.namedItem};qq.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"};qq.trimStr=function(e){if(String.prototype.trim){return e.trim()}return e.replace(/^\s+|\s+$/g,"")};qq.format=function(e){var t=Array.prototype.slice.call(arguments,1),n=e,r=n.indexOf("{}");qq.each(t,function(e,t){var i=n.substring(0,r),s=n.substring(r+2);n=i+t+s;r=n.indexOf("{}",r+t.length);if(r<0){return false}});return n};qq.isFile=function(e){return window.File&&Object.prototype.toString.call(e)==="[object File]"};qq.isFileList=function(e){return window.FileList&&Object.prototype.toString.call(e)==="[object FileList]"};qq.isFileOrInput=function(e){return qq.isFile(e)||qq.isInput(e)};qq.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();if(t){return n!=="file"}return n==="file"};if(window.HTMLInputElement){if(Object.prototype.toString.call(e)==="[object HTMLInputElement]"){if(e.type&&n(e.type)){return true}}}if(e.tagName){if(e.tagName.toLowerCase()==="input"){if(e.type&&n(e.type)){return true}}}return false};qq.isBlob=function(e){return window.Blob&&Object.prototype.toString.call(e)==="[object Blob]"};qq.isXhrUploadSupported=function(){var e=document.createElement("input");e.type="file";return e.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof qq.createXhrInstance().upload!=="undefined"};qq.createXhrInstance=function(){if(window.XMLHttpRequest){return new XMLHttpRequest}try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){qq.log("Neither XHR or ActiveX are supported!","error");return null}};qq.isFolderDropSupported=function(e){return e.items&&e.items[0].webkitGetAsEntry};qq.isFileChunkingSupported=function(){return!qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==undefined||File.prototype.webkitSlice!==undefined||File.prototype.mozSlice!==undefined)};qq.sliceBlob=function(e,t,n){var r=e.slice||e.mozSlice||e.webkitSlice;return r.call(e,t,n)};qq.arrayBufferToHex=function(e){var t="",n=new Uint8Array(e);qq.each(n,function(e,n){var r=n.toString(16);if(r.length<2){r="0"+r}t+=r});return t};qq.readBlobToHex=function(e,t,n){var r=qq.sliceBlob(e,t,t+n),i=new FileReader,s=new qq.Promise;i.onload=function(){s.success(qq.arrayBufferToHex(i.result))};i.readAsArrayBuffer(r);return s};qq.extend=function(e,t,n){qq.each(t,function(t,r){if(n&&qq.isObject(r)){if(e[t]===undefined){e[t]={}}qq.extend(e[t],r,true)}else{e[t]=r}});return e};qq.override=function(e,t){var n={},r=t(n);qq.each(r,function(t,r){if(e[t]!==undefined){n[t]=e[t]}e[t]=r});return e};qq.indexOf=function(e,t,n){if(e.indexOf){return e.indexOf(t,n)}n=n||0;var r=e.length;if(n<0){n+=r}for(;n<r;n+=1){if(e.hasOwnProperty(n)&&e[n]===t){return n}}return-1};qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.ie11=function(){return navigator.userAgent.indexOf("Trident")!==-1&&navigator.userAgent.indexOf("rv:11")!==-1};qq.safari=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};qq.opera=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Opera")!==-1};qq.firefox=function(){return!qq.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor===""};qq.windows=function(){return navigator.platform==="Win32"};qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1};qq.ios7=function(){return qq.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1};qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1};qq.preventDefault=function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;e.removeChild(n);return n}}();qq.each=function(e,t){var n,r;if(e){if(window.Storage&&e.constructor===window.Storage){for(n=0;n<e.length;n++){r=t(e.key(n),e.getItem(e.key(n)));if(r===false){break}}}else if(qq.isArray(e)||qq.isItemList(e)||qq.isNodeList(e)){for(n=0;n<e.length;n++){r=t(n,e[n]);if(r===false){break}}}else if(qq.isString(e)){for(n=0;n<e.length;n++){r=t(n,e.charAt(n));if(r===false){break}}}else{for(n in e){if(Object.prototype.hasOwnProperty.call(e,n)){r=t(n,e[n]);if(r===false){break}}}}}};qq.bind=function(e,t){if(qq.isFunction(e)){var n=Array.prototype.slice.call(arguments,2);return function(){var r=qq.extend([],n);if(arguments.length){r=r.concat(Array.prototype.slice.call(arguments))}return e.apply(t,r)}}throw new Error("first parameter must be a function!")};qq.obj2url=function(e,t,n){var r=[],i="&",s=function(e,n){var i=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;if(i!=="undefined"&&n!=="undefined"){r.push(typeof e==="object"?qq.obj2url(e,i,true):Object.prototype.toString.call(e)==="[object Function]"?encodeURIComponent(i)+"="+encodeURIComponent(e()):encodeURIComponent(i)+"="+encodeURIComponent(e))}};if(!n&&t){i=/\?/.test(t)?/\?$/.test(t)?"":"&":"?";r.push(t);r.push(qq.obj2url(e))}else if(Object.prototype.toString.call(e)==="[object Array]"&&typeof e!=="undefined"){qq.each(e,function(e,t){s(t,e)})}else if(typeof e!=="undefined"&&e!==null&&typeof e==="object"){qq.each(e,function(e,t){s(t,e)})}else{r.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}if(t){return r.join(i)}else{return r.join(i).replace(/^&/,"").replace(/%20/g,"+")}};qq.obj2FormData=function(e,t,n){if(!t){t=new FormData}qq.each(e,function(e,r){e=n?n+"["+e+"]":e;if(qq.isObject(r)){qq.obj2FormData(r,t,e)}else if(qq.isFunction(r)){t.append(e,r())}else{t.append(e,r)}});return t};qq.obj2Inputs=function(e,t){var n;if(!t){t=document.createElement("form")}qq.obj2FormData(e,{append:function(e,r){n=document.createElement("input");n.setAttribute("name",e);n.setAttribute("value",r);t.appendChild(n)}});return t};qq.setCookie=function(e,t,n){var r=new Date,i="";if(n){r.setTime(r.getTime()+n*24*60*60*1e3);i="; expires="+r.toGMTString()}document.cookie=e+"="+t+i+"; path=/"};qq.getCookie=function(e){var t=e+"=",n=document.cookie.split(";"),r;qq.each(n,function(e,n){var i=n;while(i.charAt(0)==" "){i=i.substring(1,i.length)}if(i.indexOf(t)===0){r=i.substring(t.length,i.length);return false}});return r};qq.getCookieNames=function(e){var t=document.cookie.split(";"),n=[];qq.each(t,function(t,r){r=qq.trimStr(r);var i=r.indexOf("=");if(r.match(e)){n.push(r.substr(0,i))}});return n};qq.deleteCookie=function(e){qq.setCookie(e,"",-1)};qq.areCookiesEnabled=function(){var e=Math.random()*1e5,t="qqCookieTest:"+e;qq.setCookie(t,1);if(qq.getCookie(t)){qq.deleteCookie(t);return true}return false};qq.parseJson=function(json){if(window.JSON&&qq.isFunction(JSON.parse)){return JSON.parse(json)}else{return eval("("+json+")")}};qq.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0){return e.substr(t,e.length-t)}};qq.getFilename=function(e){if(qq.isInput(e)){return e.value.replace(/.*(\/|\\)/,"")}else if(qq.isFile(e)){if(e.fileName!==null&&e.fileName!==undefined){return e.fileName}}return e.name};qq.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do{t=e.shift();if(t){t()}}while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}})();(function(){"use strict";qq.Error=function(e){this.message="[Fine Uploader "+qq.version+"] "+e};qq.Error.prototype=new Error})();qq.version="4.3.1";qq.supportedFeatures=function(){"use strict";function h(){var e=true,t;try{t=document.createElement("input");t.type="file";qq(t).hide();if(t.disabled){e=false}}catch(n){e=false}return e}function p(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)!==undefined}function d(){return(qq.chrome()||qq.opera())&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==undefined}function v(){if(window.XMLHttpRequest){var e=qq.createXhrInstance();return e.withCredentials!==undefined}return false}function m(){return window.XDomainRequest!==undefined}function g(){if(v()){return true}return m()}function y(){return document.createElement("input").webkitdirectory!==undefined}var e,t,n,r,i,s,o,u,a,f,l,c;e=h();t=e&&qq.isXhrUploadSupported();n=t&&p();r=t&&qq.isFileChunkingSupported();i=t&&r&&qq.areCookiesEnabled();s=t&&d();o=e&&(window.postMessage!==undefined||t);a=v();u=m();f=g();l=y();c=t&&window.FileReader!==undefined;return{uploading:e,ajaxUploading:t,fileDrop:t,folderDrop:n,chunking:r,resume:i,uploadCustomHeaders:t,uploadNonMultipart:t,itemSizeValidation:t,uploadViaPaste:s,progressBar:t,uploadCors:o,deleteFileCorsXhr:a,deleteFileCorsXdr:u,deleteFileCors:f,canDetermineSize:t,folderSelection:l,imagePreviews:c,imageValidation:c,pause:r}}();qq.Promise=function(){"use strict";var e,t,n=[],r=[],i=[],s=0;qq.extend(this,{then:function(i,o){if(s===0){if(i){n.push(i)}if(o){r.push(o)}}else if(s===-1){o&&o.apply(null,t)}else if(i){i.apply(null,e)}return this},done:function(n){if(s===0){i.push(n)}else{n.apply(null,t===undefined?e:t)}return this},success:function(){s=1;e=arguments;if(n.length){qq.each(n,function(t,n){n.apply(null,e)})}if(i.length){qq.each(i,function(t,n){n.apply(null,e)})}return this},failure:function(){s=-1;t=arguments;if(r.length){qq.each(r,function(e,n){n.apply(null,t)})}if(i.length){qq.each(i,function(e,n){n.apply(null,t)})}return this}})};qq.UploadButton=function(e){"use strict";function s(){var e=document.createElement("input");e.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,i);if(n.multiple){e.setAttribute("multiple","")}if(n.folders&&qq.supportedFeatures.folderSelection){e.setAttribute("webkitdirectory","")}if(n.acceptFiles){e.setAttribute("accept",n.acceptFiles)}e.setAttribute("type","file");e.setAttribute("name",n.name);qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});n.element.appendChild(e);t.attach(e,"change",function(){n.onChange(e)});t.attach(e,"mouseover",function(){qq(n.element).addClass(n.hoverClass)});t.attach(e,"mouseout",function(){qq(n.element).removeClass(n.hoverClass)});t.attach(e,"focus",function(){qq(n.element).addClass(n.focusClass)});t.attach(e,"blur",function(){qq(n.element).removeClass(n.focusClass)});if(window.attachEvent){e.setAttribute("tabIndex","-1")}return e}var t=new qq.DisposeSupport,n={element:null,multiple:false,acceptFiles:null,folders:false,name:"qqfile",onChange:function(e){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},r,i;qq.extend(n,e);i=qq.getUniqueId();qq(n.element).css({position:"relative",overflow:"hidden",direction:"ltr"});r=s();qq.extend(this,{getInput:function(){return r},getButtonId:function(){return i},setMultiple:function(e){if(e!==n.multiple){if(e){r.setAttribute("multiple","")}else{r.removeAttribute("multiple")}}},setAcceptFiles:function(e){if(e!==n.acceptFiles){r.setAttribute("accept",e)}},reset:function(){if(r.parentNode){qq(r).remove()}qq(n.element).removeClass(n.focusClass);r=s()}})};qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id";qq.UploadData=function(e){"use strict";function i(e){if(qq.isArray(e)){var n=[];qq.each(e,function(e,r){n.push(t[r])});return n}return t[e]}function s(e){if(qq.isArray(e)){var r=[];qq.each(e,function(e,i){r.push(t[n[i]])});return r}return t[n[e]]}function o(e){var n=[],i=[].concat(e);qq.each(i,function(e,i){var s=r[i];if(s!==undefined){qq.each(s,function(e,r){n.push(t[r])})}});return n}var t=[],n={},r={};qq.extend(this,{addFile:function(i,s,o,u){u=u||qq.status.SUBMITTING;var a=t.push({name:s,originalName:s,uuid:i,size:o,status:u})-1;t[a].id=a;n[i]=a;if(r[u]===undefined){r[u]=[]}r[u].push(a);e.onStatusChange(a,null,u);return a},retrieve:function(e){if(qq.isObject(e)&&t.length){if(e.id!==undefined){return i(e.id)}else if(e.uuid!==undefined){return s(e.uuid)}else if(e.status){return o(e.status)}}else{return qq.extend([],t,true)}},reset:function(){t=[];n={};r={}},setStatus:function(n,i){var s=t[n].status,o=qq.indexOf(r[s],n);r[s].splice(o,1);t[n].status=i;if(r[i]===undefined){r[i]=[]}r[i].push(n);e.onStatusChange(n,s,i)},uuidChanged:function(e,r){var i=t[e].uuid;t[e].uuid=r;n[r]=e;delete n[i]},updateName:function(e,n){t[e].name=n}})};qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"};(function(){"use strict";qq.basePublicApi={log:function(e,t){if(this._options.debug&&(!t||t==="info")){qq.log("[Fine Uploader "+qq.version+"] "+e)}else if(t&&t!=="info"){qq.log("[Fine Uploader "+qq.version+"] "+e,t)}},setParams:function(e,t){this._paramsStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getNetUploads:function(){return this._netUploaded},uploadStoredFiles:function(){var e;if(this._storedIds.length===0){this._itemError("noFilesError")}else{while(this._storedIds.length){e=this._storedIds.shift();this._uploadFile(e)}}},clearStoredFiles:function(){this._storedIds=[]},retry:function(e){return this._manualRetry(e)},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds);qq.each(e,function(e,n){t.cancel(n)});this._handler.cancelAll()},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];qq.each(this._buttons,function(e,t){t.reset()});this._paramsStore.reset();this._endpointStore.reset();this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData.reset();this._buttonIdsForFileIds=[];this._pasteHandler&&this._pasteHandler.reset();this._options.session.refreshOnReset&&this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[]},addFiles:function(e,t,n){var r=[],i,s,o;if(e){if(!qq.isFileList(e)){e=[].concat(e)}for(i=0;i<e.length;i+=1){s=e[i];if(qq.isFileOrInput(s)){if(qq.isInput(s)&&qq.supportedFeatures.ajaxUploading){for(o=0;o<s.files.length;o++){this._handleNewFile(s.files[o],r)}}else{this._handleNewFile(s,r)}}else{this.log(s+" is not a File or INPUT element!  Ignoring!","warn")}}this.log("Received "+r.length+" files or inputs.");this._prepareItemsForUpload(r,t,n)}},addBlobs:function(e,t,n){if(e){var r=[].concat(e),i=[],s=this;qq.each(r,function(e,t){var n;if(qq.isBlob(t)&&!qq.isFileOrInput(t)){n={blob:t,name:s._options.blobs.defaultName}}else if(qq.isObject(t)&&t.blob&&t.name){n=t}else{s.log("addBlobs: entry at index "+e+" is not a Blob or a BlobData object","error")}n&&s._handleNewFile(n,i)});this._prepareItemsForUpload(i,t,n)}else{this.log("undefined or non-array parameter passed into addBlobs","error")}},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getName:function(e){return this._uploadData.retrieve({id:e}).name},setName:function(e,t){this._uploadData.updateName(e,t)},getFile:function(e){return this._handler.getFile(e)},deleteFile:function(e){return this._onSubmitDelete(e)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},doesExist:function(e){return this._handler.isValid(e)},getUploads:function(e){return this._uploadData.retrieve(e)},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},drawThumbnail:function(e,t,n,r){if(this._imageGenerator){var i=this._thumbnailUrls[e],s={scale:n>0,maxSize:n>0?n:null};if(!r&&qq.supportedFeatures.imagePreviews){i=this.getFile(e)}if(i==null){return(new qq.Promise).failure(t,"File or URL not found.")}return this._imageGenerator.generate(i,t,s)}},pauseUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled){return false}if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],t.status)>=0){if(this._handler.pause(e)){this._uploadData.setStatus(e,qq.status.PAUSED);return true}else{qq.log(qq.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}}else{qq.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error")}return false},continueUpload:function(e){var t=this._uploadData.retrieve({id:e});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled){return false}if(t.status===qq.status.PAUSED){qq.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e)));this._uploadFile(e);return true}else{qq.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error")}return false},getRemainingAllowedItems:function(){var e=this._options.validation.itemLimit;if(e>0){return this._options.validation.itemLimit-this._netUploadedOrQueued}return null}};qq.basePrivateApi={_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this));if(this._formSupport&&this._formSupport.attachedToForm){this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject);this._options.autoUpload=this._formSupport.newAutoUpload;if(this._formSupport.newEndpoint){this._options.request.endpoint=this._formSupport.newEndpoint}}else{this._paramsStore=this._createStore(this._options.request.params)}},_uploadFile:function(e){if(!this._handler.upload(e)){this._uploadData.setStatus(e,qq.status.QUEUED)}},_refreshSessionData:function(){var e=this,t=this._options.session;if(qq.Session&&this._options.session.endpoint!=null){if(!this._session){qq.extend(t,this._options.cors);t.log=qq.bind(this.log,this);t.addFileRecord=qq.bind(this._addCannedFile,this);this._session=new qq.Session(t)}setTimeout(function(){e._session.refresh().then(function(t,n){e._options.callbacks.onSessionRequestComplete(t,true,n)},function(t,n){e._options.callbacks.onSessionRequestComplete(t,false,n)})},0)}},_addCannedFile:function(e){var t=this._uploadData.addFile(e.uuid,e.name,e.size,qq.status.UPLOAD_SUCCESSFUL);e.deleteFileEndpoint&&this.setDeleteFileEndpoint(e.deleteFileEndpoint,t);e.deleteFileParams&&this.setDeleteFileParams(e.deleteFileParams,t);if(e.thumbnailUrl){this._thumbnailUrls[t]=e.thumbnailUrl}this._netUploaded++;this._netUploadedOrQueued++;return t},_handleNewFile:function(e,t){var n=-1,r=qq.getUniqueId(),i=qq.getFilename(e),s;if(e.size>=0){n=e.size}else if(e.blob){n=e.blob.size}s=this._uploadData.addFile(r,i,n);this._handler.add(s,e);this._trackButton(s);this._netUploadedOrQueued++;t.push({id:s,file:e})},_trackButton:function(e){var t;if(qq.supportedFeatures.ajaxUploading){t=this._handler.getFile(e).qqButtonId}else{t=this._getButtonId(this._handler.getInput(e))}if(t){this._buttonIdsForFileIds[e]=t}},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={};qq.each(this._options.extraButtons,function(t,n){var r=n.multiple,i=qq.extend({},e._options.validation,true),s=qq.extend({},n);if(r===undefined){r=e._options.multiple}if(s.validation){qq.extend(i,n.validation,true)}qq.extend(s,{multiple:r,validation:i},true);e._initExtraButton(s)})},_initExtraButton:function(e){var t=this._createUploadButton({element:e.element,multiple:e.multiple,accept:e.validation.acceptFiles,folders:e.folders,allowedExtensions:e.validation.allowedExtensions});this._extraButtonSpecs[t.getButtonId()]=e},_getButtonId:function(e){var t,n;if(e&&!e.blob&&!qq.isBlob(e)){if(qq.isFile(e)){return e.qqButtonId}else if(e.tagName.toLowerCase()==="input"&&e.type.toLowerCase()==="file"){return e.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}t=e.getElementsByTagName("input");qq.each(t,function(e,t){if(t.getAttribute("type")==="file"){n=t;return false}});if(n){return n.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}}},_annotateWithButtonId:function(e,t){if(qq.isFile(e)){e.qqButtonId=this._getButtonId(t)}},_getButton:function(e){var t=this._extraButtonSpecs[e];if(t){return t.element}else if(e===this._defaultButtonId){return this._options.button}},_handleCheckedCallback:function(e){var t=this,n=e.callback();if(n instanceof qq.Promise){this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier);return n.then(function(n){t.log(e.name+" promise success for "+e.identifier);e.onSuccess(n)},function(){if(e.onFailure){t.log(e.name+" promise failure for "+e.identifier);e.onFailure()}else{t.log(e.name+" promise failure for "+e.identifier)}})}if(n!==false){e.onSuccess(n)}else{if(e.onFailure){this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback.");e.onFailure()}else{this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed.")}}return n},_createUploadButton:function(e){function i(){if(qq.supportedFeatures.ajaxUploading){if(qq.ios7()&&t._isAllowedExtension(r,".mov")){return false}if(e.multiple===undefined){return t._options.multiple}return e.multiple}return false}var t=this,n=e.accept||this._options.validation.acceptFiles,r=e.allowedExtensions||this._options.validation.allowedExtensions;var s=new qq.UploadButton({element:e.element,folders:e.folders,name:this._options.request.inputName,multiple:i(),acceptFiles:n,onChange:function(e){t._onInputChange(e)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});this._disposeSupport.addDisposer(function(){s.dispose()});t._buttons.push(s);return s},_createUploadHandler:function(e,t){var n=this,r={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,demoMode:this._options.demoMode,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(n.log,n),onProgress:function(e,t,r,i){n._onProgress(e,t,r,i);n._options.callbacks.onProgress(e,t,r,i)},onComplete:function(e,t,r,i){var s=n._onComplete(e,t,r,i);if(s instanceof qq.Promise){s.done(function(){n._options.callbacks.onComplete(e,t,r,i)})}else{n._options.callbacks.onComplete(e,t,r,i)}},onCancel:function(e,t){return n._handleCheckedCallback({name:"onCancel",callback:qq.bind(n._options.callbacks.onCancel,n,e,t),onSuccess:qq.bind(n._onCancel,n,e,t),identifier:e})},onUpload:function(e,t){n._onUpload(e,t);n._options.callbacks.onUpload(e,t)},onUploadChunk:function(e,t,r){n._onUploadChunk(e,r);n._options.callbacks.onUploadChunk(e,t,r)},onUploadChunkSuccess:function(e,t,r,i){n._options.callbacks.onUploadChunkSuccess.apply(n,arguments)},onResume:function(e,t,r){return n._options.callbacks.onResume(e,t,r)},onAutoRetry:function(e,t,r,i){return n._onAutoRetry.apply(n,arguments)},onUuidChanged:function(e,t){n.log("Server requested UUID change from '"+n.getUuid(e)+"' to '"+t+"'");n.setUuid(e,t)},getName:qq.bind(n.getName,n),getUuid:qq.bind(n.getUuid,n),getSize:qq.bind(n.getSize,n)};qq.each(this._options.request,function(e,t){r[e]=t});if(e){qq.each(e,function(e,t){r[e]=t})}return new qq.UploadHandler(r,t)},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:qq.bind(e.log,e),onDelete:function(t){e._onDelete(t);e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,r){e._onDeleteComplete(t,n,r);e._options.callbacks.onDeleteComplete(t,n,r)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(e.log,e),pasteReceived:function(t){e._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(e._options.callbacks.onPasteReceived,e,t),onSuccess:qq.bind(e._handlePasteSuccess,e,t),identifier:"pasted image"})}}})},_createUploadDataTracker:function(){var e=this;return new qq.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,r){e._onUploadStatusChange(t,n,r);e._options.callbacks.onStatusChange(t,n,r);e._maybeAllComplete(t,r)}})},_onUploadStatusChange:function(e,t,n){if(n===qq.status.PAUSED){clearTimeout(this._retryTimeouts[e])}},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],r=t;if(r==null){r=this._options.paste.defaultName}r+="."+n;this.addBlobs({name:r,blob:e})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress()){t=t||window.event;t.returnValue=e._options.messages.onLeave;return e._options.messages.onLeave}})},_onSubmit:function(e,t){},_onProgress:function(e,t,n,r){},_onComplete:function(e,t,n,r){if(!n.success){this._netUploadedOrQueued--;this._uploadData.setStatus(e,qq.status.UPLOAD_FAILED)}else{if(n.thumbnailUrl){this._thumbnailUrls[e]=n.thumbnailUrl}this._netUploaded++;this._uploadData.setStatus(e,qq.status.UPLOAD_SUCCESSFUL)}this._maybeParseAndSendUploadError(e,t,n,r);return n.success?true:false},_maybeAllComplete:function(e,t){var n=this,r=this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length;if(t===qq.status.UPLOAD_SUCCESSFUL){this._succeededSinceLastAllComplete.push(e)}else if(t===qq.status.UPLOAD_FAILED){this._failedSinceLastAllComplete.push(e)}if(r===0&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)){setTimeout(function(){n._options.callbacks.onAllComplete(qq.extend([],n._succeededSinceLastAllComplete),qq.extend([],n._failedSinceLastAllComplete));n._succeededSinceLastAllComplete=[];n._failedSinceLastAllComplete=[]},0)}},_onCancel:function(e,t){this._netUploadedOrQueued--;clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);if(!this._options.autoUpload&&n>=0){this._storedIds.splice(n,1)}this._uploadData.setStatus(e,qq.status.CANCELED)},_isDeletePossible:function(){if(!qq.DeleteFileAjaxRequester||!this._options.deleteFile.enabled){return false}if(this._options.cors.expected){if(qq.supportedFeatures.deleteFileCorsXhr){return true}if(qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr){return true}return false}return true},_onSubmitDelete:function(e,t,n){var r=this.getUuid(e),i;if(t){i=qq.bind(t,this,e,r,n)}if(this._isDeletePossible()){this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:i||qq.bind(this._deleteHandler.sendDelete,this,e,r,n),identifier:e});return true}else{this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible "+"due to CORS on a user agent that does not support pre-flighting.","warn");return false}},_onDelete:function(e){this._uploadData.setStatus(e,qq.status.DELETING)},_onDeleteComplete:function(e,t,n){var r=this.getName(e);if(n){this._uploadData.setStatus(e,qq.status.DELETE_FAILED);this.log("Delete request for '"+r+"' has failed.","error");if(t.withCredentials===undefined){this._options.callbacks.onError(e,r,"Delete request failed",t)}else{this._options.callbacks.onError(e,r,"Delete request failed with response code "+t.status,t)}}else{this._netUploadedOrQueued--;this._netUploaded--;this._handler.expunge(e);this._uploadData.setStatus(e,qq.status.DELETED);this.log("Delete request for '"+r+"' has succeeded.")}},_onUpload:function(e,t){this._uploadData.setStatus(e,qq.status.UPLOADING)},_onUploadChunk:function(e,t){},_onInputChange:function(e){var t;if(qq.supportedFeatures.ajaxUploading){for(t=0;t<e.files.length;t++){this._annotateWithButtonId(e.files[t],e)}this.addFiles(e.files)}else if(e.value.length>0){this.addFiles(e)}qq.each(this._buttons,function(e,t){t.reset()})},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onAutoRetry:function(e,t,n,r,i){var s=this;s._preventRetries[e]=n[s._options.retry.preventRetryResponseProperty];if(s._shouldAutoRetry(e,t,n)){s._maybeParseAndSendUploadError.apply(s,arguments);s._options.callbacks.onAutoRetry(e,t,s._autoRetries[e]+1);s._onBeforeAutoRetry(e,t);s._retryTimeouts[e]=setTimeout(function(){s.log("Retrying "+t+"...");s._autoRetries[e]++;s._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING);if(i){i(e)}else{s._handler.retry(e)}},s._options.retry.autoAttemptDelay*1e3);return true}},_shouldAutoRetry:function(e,t,n){var r=this._uploadData.retrieve({id:e});if(!this._preventRetries[e]&&this._options.retry.enableAuto&&r.status!==qq.status.PAUSED){if(this._autoRetries[e]===undefined){this._autoRetries[e]=0}return this._autoRetries[e]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(e){var t=this._options.validation.itemLimit;if(this._preventRetries[e]){this.log("Retries are forbidden for id "+e,"warn");return false}else if(this._handler.isValid(e)){var n=this.getName(e);if(this._options.callbacks.onManualRetry(e,n)===false){return false}if(t>0&&this._netUploadedOrQueued+1>t){this._itemError("retryFailTooManyItems");return false}this.log("Retrying upload for '"+n+"' (id: "+e+")...");return true}else{this.log("'"+e+"' is not a valid file ID","error");return false}},_manualRetry:function(e,t){if(this._onBeforeManualRetry(e)){this._netUploadedOrQueued++;this._uploadData.setStatus(e,qq.status.UPLOAD_RETRYING);if(t){t(e)}else{this._handler.retry(e)}return true}},_maybeParseAndSendUploadError:function(e,t,n,r){if(!n.success){if(r&&r.status!==200&&!n.error){this._options.callbacks.onError(e,t,"XHR returned response code "+r.status,r)}else{var i=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,i,r)}}},_prepareItemsForUpload:function(e,t,n){if(e.length===0){this._itemError("noFilesError");return}var r=this._getValidationDescriptors(e),i=this._getButtonId(e[0].file),s=this._getButton(i);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,r,s),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,r,e,t,n,s),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_upload:function(e,t,n){var r=this.getName(e);if(t){this.setParams(t,e)}if(n){this.setEndpoint(n,e)}this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,e,r),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,e,r),onFailure:qq.bind(this._fileOrBlobRejected,this,e,r),identifier:e})},_onSubmitCallbackSuccess:function(e,t){this._onSubmit.apply(this,arguments);this._uploadData.setStatus(e,qq.status.SUBMITTED);this._onSubmitted.apply(this,arguments);this._options.callbacks.onSubmitted.apply(this,arguments);if(this._options.autoUpload){this._uploadFile(e)}else{this._storeForLater(e)}},_onSubmitted:function(e){},_storeForLater:function(e){this._storedIds.push(e)},_onValidateBatchCallbackSuccess:function(e,t,n,r,i){var s,o=this._options.validation.itemLimit,u=this._netUploadedOrQueued;if(o===0||u<=o){if(t.length>0){this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,e[0],i),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,t,0,n,r),onFailure:qq.bind(this._onValidateCallbackFailure,this,t,0,n,r),identifier:"Item '"+t[0].file.name+"', size: "+t[0].file.size})}else{this._itemError("noFilesError")}}else{this._onValidateBatchCallbackFailure(t);s=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,u).replace(/\{itemLimit\}/g,o);this._batchError(s)}},_onValidateBatchCallbackFailure:function(e){var t=this;qq.each(e,function(e,n){t._fileOrBlobRejected(n.id)})},_onValidateCallbackSuccess:function(e,t,n,r){var i=this,s=t+1,o=this._getValidationDescriptor(e[t].file);this._validateFileOrBlobData(e[t],o).then(function(){i._upload(e[t].id,n,r);i._maybeProcessNextItemAfterOnValidateCallback(true,e,s,n,r)},function(){i._maybeProcessNextItemAfterOnValidateCallback(false,e,s,n,r)})},_onValidateCallbackFailure:function(e,t,n,r){var i=t+1;this._fileOrBlobRejected(e[0].id,e[0].file.name);this._maybeProcessNextItemAfterOnValidateCallback(false,e,i,n,r)},_maybeProcessNextItemAfterOnValidateCallback:function(e,t,n,r,i){var s=this;if(t.length>n){if(e||!this._options.validation.stopOnFirstInvalidFile){setTimeout(function(){var e=s._getValidationDescriptor(t[n].file);s._handleCheckedCallback({name:"onValidate",callback:qq.bind(s._options.callbacks.onValidate,s,t[n].file),onSuccess:qq.bind(s._onValidateCallbackSuccess,s,t,n,r,i),onFailure:qq.bind(s._onValidateCallbackFailure,s,t,n,r,i),identifier:"Item '"+e.name+"', size: "+e.size})},0)}else if(!e){for(;n<t.length;n++){s._fileOrBlobRejected(t[n].id)}}}},_validateFileOrBlobData:function(e,t){var n=this,r=e.file,i=t.name,s=t.size,o=this._getButtonId(r),u=this._getValidationBase(o),a=new qq.Promise;a.then(function(){},function(){n._fileOrBlobRejected(e.id,i)});if(qq.isFileOrInput(r)&&!this._isAllowedExtension(u.allowedExtensions,i)){this._itemError("typeError",i,r);return a.failure()}if(s===0){this._itemError("emptyError",i,r);return a.failure()}if(s&&u.sizeLimit&&s>u.sizeLimit){this._itemError("sizeError",i,r);return a.failure()}if(s&&s<u.minSizeLimit){this._itemError("minSizeError",i,r);return a.failure()}if(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(r)){(new qq.ImageValidation(r,qq.bind(n.log,n))).validate(u.image).then(a.success,function(e){n._itemError(e+"ImageError",i,r);a.failure()})}else{a.success()}return a},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--;this._uploadData.setStatus(e,qq.status.REJECTED)},_itemError:function(e,t,n){function c(e,t){r=r.replace(e,t)}var r=this._options.messages[e],i=[],s=[].concat(t),o=s[0],u=this._getButtonId(n),a=this._getValidationBase(u),f,l;qq.each(a.allowedExtensions,function(e,t){if(qq.isString(t)){i.push(t)}});f=i.join(", ").toLowerCase();c("{file}",this._options.formatFileName(o));c("{extensions}",f);c("{sizeLimit}",this._formatSize(a.sizeLimit));c("{minSizeLimit}",this._formatSize(a.minSizeLimit));l=r.match(/(\{\w+\})/g);if(l!==null){qq.each(l,function(e,t){c(t,s[e])})}this._options.callbacks.onError(null,o,r,undefined);return r},_batchError:function(e){this._options.callbacks.onError(null,null,e,undefined)},_isAllowedExtension:function(e,t){var n=false;if(!e.length){return true}qq.each(e,function(e,r){if(qq.isString(r)){var i=new RegExp("\\."+r+"$","i");if(t.match(i)!=null){n=true;return false}}});return n},_formatSize:function(e){var t=-1;do{e=e/1e3;t++}while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_wrapCallbacks:function(){var e,t;e=this;t=function(t,n,r){var i;try{return n.apply(e,r)}catch(s){i=s.message||s.toString();e.log("Caught exception in '"+t+"' callback - "+i,"error")}};for(var n in this._options.callbacks){(function(){var r,i;r=n;i=e._options.callbacks[r];e._options.callbacks[r]=function(){return t(r,i,arguments)}})()}},_parseFileOrBlobDataName:function(e){var t;if(qq.isFileOrInput(e)){if(e.value){t=e.value.replace(/.*(\/|\\)/,"")}else{t=e.fileName!==null&&e.fileName!==undefined?e.fileName:e.name}}else{t=e.name}return t},_parseFileOrBlobDataSize:function(e){var t;if(qq.isFileOrInput(e)){if(e.value===undefined){t=e.fileSize!==null&&e.fileSize!==undefined?e.fileSize:e.size}}else{t=e.blob.size}return t},_getValidationDescriptor:function(e){var t={},n=this._parseFileOrBlobDataName(e),r=this._parseFileOrBlobDataSize(e);t.name=n;if(r!==undefined){t.size=r}return t},_getValidationDescriptors:function(e){var t=this,n=[];qq.each(e,function(e,r){n.push(t._getValidationDescriptor(r.file))});return n},_createStore:function(e,t){var n={},r=e,i=function(e){if(qq.isObject(e)){return qq.extend({},e)}return e},s=function(){if(qq.isFunction(t)){return t()}return t},o=function(e){if(t&&qq.isObject(e)){qq.extend(e,s())}};return{set:function(e,t){if(t==null){n={};r=i(e)}else{n[t]=i(e)}},get:function(e){var t;if(e!=null&&n[e]){t=n[e]}else{t=r}o(t);return i(t)},remove:function(e){return delete n[e]},reset:function(){n={};r=e}}},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var e="image/*;capture=camera",t=this._options.camera.button,n=t?this._getButtonId(t):this._defaultButtonId,r=this._options;if(n&&n!==this._defaultButtonId){r=this._extraButtonSpecs[n]}r.multiple=false;if(r.validation.acceptFiles===null){r.validation.acceptFiles=e}else{r.validation.acceptFiles+=","+e}qq.each(this._buttons,function(e,t){if(t.getButtonId()===n){t.setMultiple(r.multiple);t.setAcceptFiles(r.acceptFiles);return false}})}},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation}}})();(function(){"use strict";qq.FineUploaderBasic=function(e){this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:"/server/upload",params:{},paramsInBody:true,customHeaders:{},forceMultipart:true,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",filenameParam:"qqfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:true,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0}},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,r){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,r){},onResume:function(e,t,n){},onProgress:function(e,t,n,r){},onError:function(e,t,n,r){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){},onSessionRequestComplete:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:false,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){if(e!==undefined&&e.length>33){e=e.slice(0,19)+"..."+e.slice(-14)}return e},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:false,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:false,sendCredentials:false,allowXdr:false},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:false,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:true},form:{element:"qq-form",autoUpload:false,interceptSubmit:true}};qq.extend(this._options,e,true);this._buttons=[];this._extraButtonSpecs={};this._buttonIdsForFileIds=[];this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport;this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData=this._createUploadDataTracker();this._initFormSupportAndParams();this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params);this._endpointStore=this._createStore(this._options.request.endpoint);this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint);this._handler=this._createUploadHandler();this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler();if(this._options.button){this._defaultButtonId=this._createUploadButton({element:this._options.button}).getButtonId()}this._generateExtraButtonSpecs();this._handleCameraAccess();if(this._options.paste.targetElement){if(qq.PasteSupport){this._pasteHandler=this._createPasteHandler()}else{qq.log("Paste support module not found","info")}}this._preventLeaveInProgress();this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this));this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[]};qq.FineUploaderBasic.prototype=qq.basePublicApi;qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)})();qq.AjaxRequester=function(e){"use strict";function o(){return qq.indexOf(["GET","POST","HEAD"],s.method)>=0}function u(e){var t=false;qq.each(t,function(e,n){if(qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],n)<0){t=true;return false}});return t}function a(e){return s.cors.expected&&e.withCredentials===undefined}function f(){var e;if(window.XMLHttpRequest||window.ActiveXObject){e=qq.createXhrInstance();if(e.withCredentials===undefined){e=new XDomainRequest}}return e}function l(e,t){var n=i[e].xhr;if(!n&&!t){if(s.cors.expected){n=f()}else{n=qq.createXhrInstance()}i[e].xhr=n}return n}function c(e){var t=qq.indexOf(r,e),n=s.maxConnections,o;delete i[e];r.splice(t,1);if(r.length>=n&&t<n){o=r[n-1];d(o)}}function h(e,n){var r=l(e),i=s.method,o=n===true;c(e);if(o){t(i+" request for "+e+" has failed","error")}else if(!a(r)&&!E(r.status)){o=true;t(i+" request for "+e+" has failed - response code "+r.status,"error")}s.onComplete(e,r,o)}function p(e){var t=i[e].additionalParams,n=s.mandatedParams,r;if(s.paramsStore.get){r=s.paramsStore.get(e)}if(t){qq.each(t,function(e,t){r=r||{};r[e]=t})}if(n){qq.each(n,function(e,t){r=r||{};r[e]=t})}return r}function d(e){var r=l(e),o=s.method,u=p(e),f=i[e].payload,c;s.onSend(e);c=v(e,u);if(a(r)){r.onload=y(e);r.onerror=b(e)}else{r.onreadystatechange=m(e)}g(e);r.open(o,c,true);if(s.cors.expected&&s.cors.sendCredentials&&!a(r)){r.withCredentials=true}w(e);t("Sending "+o+" request for "+e);if(f){r.send(f)}else if(n||!u){r.send()}else if(u&&s.contentType&&s.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0){r.send(qq.obj2url(u,""))}else if(u&&s.contentType&&s.contentType.toLowerCase().indexOf("application/json")>=0){r.send(JSON.stringify(u))}else{r.send(u)}return r}function v(e,t){var r=s.endpointStore.get(e),o=i[e].addToPath;if(o!=undefined){r+="/"+o}if(n&&t){return qq.obj2url(t,r)}else{return r}}function m(e){return function(){if(l(e).readyState===4){h(e)}}}function g(e){var t=s.onProgress;if(t){l(e).upload.onprogress=function(n){if(n.lengthComputable){t(e,n.loaded,n.total)}}}}function y(e){return function(){h(e)}}function b(e){return function(){h(e,true)}}function w(e){var t=l(e),n=s.customHeaders,r=i[e].additionalHeaders||{},f=s.method,c={};if(!a(t)){if(s.allowXRequestedWithAndCacheControl){if(!s.cors.expected||!o()||u(n)){t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.setRequestHeader("Cache-Control","no-cache")}}if(s.contentType&&(f==="POST"||f==="PUT")){t.setRequestHeader("Content-Type",s.contentType)}qq.extend(c,qq.isFunction(n)?n(e):n);qq.extend(c,r);qq.each(c,function(e,n){t.setRequestHeader(e,n)})}}function E(e){return qq.indexOf(s.successfulResponseCodes[s.method],e)>=0}function S(e,t,n,o,u){i[e]={addToPath:t,additionalParams:n,additionalHeaders:o,payload:u};var a=r.push(e);if(a<=s.maxConnections){return d(e)}}var t,n,r=[],i={},s={validMethods:["POST"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:true,successfulResponseCodes:{DELETE:[200,202,204],POST:[200,204],GET:[200]},cors:{expected:false,sendCredentials:false},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onProgress:null};qq.extend(s,e);t=s.log;if(qq.indexOf(s.validMethods,s.method)<0){throw new Error("'"+s.method+"' is not a supported method for this type of request!")}n=s.method==="GET"||s.method==="DELETE";qq.extend(this,{initTransport:function(e){var t,n,r,i,o;return{withPath:function(e){t=e;return this},withParams:function(e){n=e;return this},withHeaders:function(e){r=e;return this},withPayload:function(e){i=e;return this},withCacheBuster:function(){o=true;return this},send:function(){if(o&&qq.indexOf(["GET","DELETE"],s.method)>=0){n.qqtimestamp=(new Date).getTime()}return S(e,t,n,r,i)}}},canceled:function(e){c(e)}})};qq.UploadHandler=function(e,t){"use strict";function o(e){var t=qq.indexOf(n,e),i=r.maxConnections,o;if(t>=0){n.splice(t,1);if(n.length>=i&&t<i){o=n[i-1];s.upload(o)}}}function u(e){i("Cancelling "+e);r.paramsStore.remove(e);o(e)}function a(){var e=t?qq[t]:qq,n=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";s=new e["UploadHandler"+n](r,{onUploadComplete:o,onUuidChanged:r.onUuidChanged,getName:r.getName,getUuid:r.getUuid,getSize:r.getSize,log:i})}var n=[],r,i,s;r={debug:false,forceMultipart:true,paramsInBody:false,paramsStore:{},endpointStore:{},filenameParam:"qqfilename",cors:{expected:false,sendCredentials:false},maxConnections:3,uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",chunking:{enabled:false,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},log:function(e,t){},onProgress:function(e,t,n,r){},onComplete:function(e,t,n,r){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,r){},onAutoRetry:function(e,t,n,r){},onResume:function(e,t,n){},onUuidChanged:function(e,t){},getName:function(e){}};qq.extend(r,e);i=r.log;qq.extend(this,{add:function(e,t){return s.add.apply(this,arguments)},upload:function(e){var t=n.push(e);if(t<=r.maxConnections){s.upload(e);return true}return false},retry:function(e){var t=qq.indexOf(n,e);if(t>=0){return s.upload(e,true)}else{return this.upload(e)}},cancel:function(e){var t=s.cancel(e);if(t instanceof qq.Promise){t.then(function(){u(e)})}else if(t!==false){u(e)}},cancelAll:function(){var e=this,t=[];qq.extend(t,n);qq.each(t,function(t,n){e.cancel(n)});n=[]},getFile:function(e){if(s.getFile){return s.getFile(e)}},getInput:function(e){if(s.getInput){return s.getInput(e)}},reset:function(){i("Resetting upload handler");this.cancelAll();n=[];s.reset()},expunge:function(e){if(this.isValid(e)){return s.expunge(e)}},isValid:function(e){return s.isValid(e)},getResumableFilesData:function(){if(s.getResumableFilesData){return s.getResumableFilesData()}return[]},getThirdPartyFileId:function(e){if(s.getThirdPartyFileId&&this.isValid(e)){return s.getThirdPartyFileId(e)}},pause:function(e){if(s.pause&&this.isValid(e)&&s.pause(e)){o(e);return true}}});a()};qq.AbstractUploadHandlerForm=function(e){"use strict";function g(e){delete o[e];delete f[e];if(a){clearTimeout(u[e]);delete u[e];m.stopReceivingMessages(e)}var t=document.getElementById(n._getIframeName(e));if(t){t.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;");qq(t).remove()}}function y(e,t){var r=e.id,i=w(r),a=d(i);s[a]=t;o[i]=qq(e).attach("load",function(){if(f[i].input){v("Received iframe load event for CORS upload request (iframe name "+r+")");u[r]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+r;v(e,"error");t({error:e})},1e3)}});m.receiveMessage(r,function(e){v("Received the following window message: '"+e+"'");var t=w(r),i=n._parseJsonResponse(t,e),o=i.uuid,a;if(o&&s[o]){v("Handling response for iframe name "+r);clearTimeout(u[r]);delete u[r];n._detachLoadEvent(r);a=s[o];delete s[o];m.stopReceivingMessages(r);a(i)}else if(!o){v("'"+e+"' does not contain a UUID - ignoring.")}})}function b(e){var t=qq.toElement("<iframe src='javascript:false;' name='"+e+"' />");t.setAttribute("id",e);t.style.display="none";document.body.appendChild(t);return t}function w(e){return e.split("_")[0]}var t=e.options,n=this,r=e.proxy,i=qq.getUniqueId(),s={},o={},u={},a=t.isCors,f={},l=t.inputName,c=r.onCancel,h=r.onUuidChanged,p=r.getName,d=r.getUuid,v=r.log,m=new qq.WindowReceiveMessage({log:v});qq.extend(this,{add:function(e,t){f[e]={input:t};t.setAttribute("name",l);if(t.parentNode){qq(t).remove()}},getInput:function(e){return f[e].input},isValid:function(e){return f[e]!==undefined&&f[e].input!==undefined},reset:function(){f.length=0},expunge:function(e){return g(e)},cancel:function(e){var t=c(e,p(e));if(t instanceof qq.Promise){return t.then(function(){this.expunge(e)})}else if(t!==false){this.expunge(e);return true}return false},upload:function(e){},_getIframeName:function(e){return e+"_"+i},_createIframe:function(e){var t=n._getIframeName(e);return b(t)},_parseJsonResponse:function(e,t){var n;try{n=qq.parseJson(t);if(n.newUuid!==undefined){h(e,n.newUuid)}}catch(r){v("Error when attempting to parse iframe upload response ("+r.message+")","error");n={}}return n},_initFormForUpload:function(e){var t=e.method,n=e.endpoint,r=e.params,i=e.paramsInBody,s=e.targetName,o=qq.toElement("<form method='"+t+"' enctype='multipart/form-data'></form>"),u=n;if(i){qq.obj2Inputs(r,o)}else{u=qq.obj2url(r,n)}o.setAttribute("action",u);o.setAttribute("target",s);o.style.display="none";document.body.appendChild(o);return o},_attachLoadEvent:function(e,t){var n;if(a){y(e,t)}else{o[e.id]=qq(e).attach("load",function(){v("Received response for "+e.id);if(!e.parentNode){return}try{if(e.contentDocument&&e.contentDocument.body&&e.contentDocument.body.innerHTML=="false"){return}}catch(r){v("Error when attempting to access iframe during handling of upload response ("+r.message+")","error");n={success:false}}t(n)})}},_detachLoadEvent:function(e){if(o[e]!==undefined){o[e]();delete o[e]}},_getFileState:function(e){return f[e]}})};qq.AbstractUploadHandlerXhr=function(e){"use strict";function c(e,t,n){if(e.slice){return e.slice(t,n)}else if(e.mozSlice){return e.mozSlice(t,n)}else if(e.webkitSlice){return e.webkitSlice(t,n)}}function h(e){var t=i[e].xhr,n=i[e].currentAjaxRequester;t.onreadystatechange=null;t.upload.onprogress=null;t.abort();n&&n.canceled&&n.canceled(e)}var t=this,n=e.options,r=e.proxy,i={},s=n.chunking,o=r.onUpload,u=r.onCancel,a=r.getName,f=r.getSize,l=r.log;qq.extend(this,{add:function(e,t){if(qq.isFile(t)){i[e]={file:t}}else if(qq.isBlob(t.blob)){i[e]={blobData:t}}else{throw new Error("Passed obj is not a File or BlobData (in qq.UploadHandlerXhr)")}},getFile:function(e){if(i[e]){return i[e].file||i[e].blobData.blob}},isValid:function(e){return i[e]!==undefined},reset:function(){i.length=0},expunge:function(e){var t=i[e].xhr;t&&h(e);delete i[e]},upload:function(e,t){i[e]&&delete i[e].paused;return o(e,t)},cancel:function(e){var t=u(e,a(e));if(t instanceof qq.Promise){return t.then(function(){i[e].canceled=true;this.expunge(e)})}else if(t!==false){i[e].canceled=true;this.expunge(e);return true}return false},pause:function(e){var t=i[e].xhr;if(t){l(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,a(e)));i[e].paused=true;h(e);return true}},_createXhr:function(e){return this._registerXhr(e,qq.createXhrInstance())},_registerXhr:function(e,t,n){i[e].xhr=t;i[e].currentAjaxRequester=n;return t},_getMimeType:function(e){return t.getFile(e).type},_getTotalChunks:function(e){if(s){var t=f(e),n=s.partSize;return Math.ceil(t/n)}},_getChunkData:function(e,n){var r=s.partSize,i=f(e),o=t.getFile(e),u=r*n,a=u+r>=i?i:u+r,l=this._getTotalChunks(e);return{part:n,start:u,end:a,count:l,blob:c(o,u,a),size:a-u}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getFileState:function(e){return i[e]}})};qq.WindowReceiveMessage=function(e){"use strict";var t={log:function(e,t){}},n={};qq.extend(t,e);qq.extend(this,{receiveMessage:function(e,t){var r=function(e){t(e.data)};if(window.postMessage){n[e]=qq(window).attach("message",r)}else{log("iframe message passing not supported in this browser!","error")}},stopReceivingMessages:function(e){if(window.postMessage){var t=n[e];if(t){t()}}}})};(function(){"use strict";qq.uiPublicApi={clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments);this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){if(this._dnd){return this._dnd.removeDropzone(e)}},getItemByFileId:function(e){return this._templating.getFileContainer(e)},reset:function(){this._parent.prototype.reset.apply(this,arguments);this._templating.reset();if(!this._options.button&&this._templating.getButton()){this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()}if(this._dnd){this._dnd.dispose();this._dnd=this._setupDragAndDrop()}this._totalFilesInBatch=0;this._filesInBatchAddedToUi=0;this._setupClickAndEditEventHandlers()},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);t&&this._templating.uploadPaused(e);return t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);t&&this._templating.uploadContinued(e);return t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){var t=this.getFile(e);return t.qqDropTarget}};qq.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);if(!t){if(e===this._defaultButtonId){t=this._templating.getButton()}}return t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent();this._focusinEventSupported=!qq.firefox();if(this._isEditFilenameEnabled()){this._filenameClickHandler=this._bindFilenameClickEvent();this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent();this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent()}},_setupDragAndDrop:function(){var e=this,t=this._options.dragAndDrop.extraDropzones,n=this._templating,r=n.getDropZone();r&&t.push(r);return new qq.DragAndDrop({dropZoneElements:t,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){n.showDropProcessing()},processingDroppedFilesComplete:function(t,r){n.hideDropProcessing();qq.each(t,function(e,t){t.qqDropTarget=r});if(t.length){e.addFiles(t,null,null)}},dropError:function(t,n){e._itemError(t,n)},dropLog:function(t,n){e.log(t,n)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(t,n){e.log(t,n)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){qq(e._templating.getFileContainer(t)).removeClass(e._classes.retryable);e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,t=this._templating;return{templating:t,log:function(t,n){e.log(t,n)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(n,r){var i=e._options.formatFileName(r);t.updateFilename(n,i);e.setName(n,r)},onEditingStatusChange:function(e,n){var r=qq(t.getEditInput(e)),i=qq(t.getFileContainer(e));if(n){r.addClass("qq-editing");t.hideFilename(e);t.hideEditIcon(e)}else{r.removeClass("qq-editing");t.showFilename(e);t.showEditIcon(e)}i.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,t,n){this._parent.prototype._onUploadStatusChange.apply(this,arguments);if(this._isEditFilenameEnabled()){if(this._templating.getFileContainer(e)&&n!==qq.status.SUBMITTED){this._templating.markFilenameEditable(e);this._templating.hideEditIcon(e)}}},_bindFilenameInputFocusInEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments);this._templating.hideSpinner(e)},_onSubmit:function(e,t){this._parent.prototype._onSubmit.apply(this,arguments);this._addToList(e,t)},_onSubmitted:function(e){if(this._isEditFilenameEnabled()){this._templating.markFilenameEditable(e);this._templating.showEditIcon(e);if(!this._focusinEventSupported){this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e))}}},_onProgress:function(e,t,n,r){this._parent.prototype._onProgress.apply(this,arguments);this._templating.updateProgress(e,n,r);if(n===r){this._templating.hideCancel(e);this._templating.hidePause(e);this._templating.setStatusText(e,this._options.text.waitingForResponse);this._displayFileSize(e)}else{this._displayFileSize(e,n,r)}},_onComplete:function(e,t,n,r){function u(t){s.setStatusText(e);qq(s.getFileContainer(e)).removeClass(o._classes.retrying);s.hideProgress(e);if(!o._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){s.hideCancel(e)}s.hideSpinner(e);if(t.success){o._markFileAsSuccessful(e)}else{qq(s.getFileContainer(e)).addClass(o._classes.fail);if(o._templating.isRetryPossible()&&!o._preventRetries[e]){qq(s.getFileContainer(e)).addClass(o._classes.retryable)}o._controlFailureTextDisplay(e,t)}}var i=this._parent.prototype._onComplete.apply(this,arguments),s=this._templating,o=this;if(i instanceof qq.Promise){i.done(function(e){u(e)})}else{u(n)}return i},_markFileAsSuccessful:function(e){var t=this._templating;if(this._isDeletePossible()){t.showDeleteButton(e)}qq(t.getFileContainer(e)).addClass(this._classes.success);this._maybeUpdateThumbnail(e)},_onUpload:function(e,t){var n=this._parent.prototype._onUpload.apply(this,arguments);this._templating.showSpinner(e);return n},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments);t.partIndex>0&&this._templating.allowPause(e)},_onCancel:function(e,t){this._parent.prototype._onCancel.apply(this,arguments);this._removeFileItem(e)},_onBeforeAutoRetry:function(e){var t,n,r;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments);this._showCancelLink(e);if(this._options.retry.showAutoRetryNote){t=this._autoRetries[e]+1;n=this._options.retry.maxAutoAttempts;r=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,t);r=r.replace(/\{maxAuto\}/g,n);this._templating.setStatusText(e,r);qq(this._templating.getFileContainer(e)).addClass(this._classes.retrying)}},_onBeforeManualRetry:function(e){if(this._parent.prototype._onBeforeManualRetry.apply(this,arguments)){this._templating.resetProgress(e);qq(this._templating.getFileContainer(e)).removeClass(this._classes.fail);this._templating.setStatusText(e);this._templating.showSpinner(e);this._showCancelLink(e);return true}else{qq(this._templating.getFileContainer(e)).addClass(this._classes.retryable);return false}},_onSubmitDelete:function(e){var t=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,t)},_onSubmitDeleteSuccess:function(e,t,n){if(this._options.deleteFile.forceConfirm){this._showDeleteConfirm.apply(this,arguments)}else{this._sendDeleteRequest.apply(this,arguments)}},_onDeleteComplete:function(e,t,n){this._parent.prototype._onDeleteComplete.apply(this,arguments);this._templating.hideSpinner(e);if(n){this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText);this._templating.showDeleteButton(e)}else{this._removeFileItem(e)}},_sendDeleteRequest:function(e,t,n){this._templating.hideDeleteButton(e);this._templating.showSpinner(e);this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText);this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e,t,n){var r=this.getName(e),i=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,r),t=this.getUuid(e),s=arguments,o=this,u;u=this._options.showConfirm(i);if(u instanceof qq.Promise){u.then(function(){o._sendDeleteRequest.apply(o,s)})}else if(u!==false){o._sendDeleteRequest.apply(o,s)}},_addToList:function(e,t,n){var r,i=0;if(this._options.display.prependFiles){if(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0){i=this._filesInBatchAddedToUi-1}r={index:i}}if(!n){if(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading){this._templating.disableCancel()}if(!this._options.multiple){this._handler.cancelAll();this._clearList()}}this._templating.addFile(e,this._options.formatFileName(t),r);if(n){this._thumbnailUrls[e]&&this._templating.updateThumbnail(e,this._thumbnailUrls[e],true)}else{this._templating.generatePreview(e,this.getFile(e))}this._filesInBatchAddedToUi+=1;if(n||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading){this._displayFileSize(e)}},_clearList:function(){this._templating.clearFiles();this.clearStoredFiles()},_displayFileSize:function(e,t,n){var r=this.getSize(e),i=this._formatSize(r);if(r>=0){if(t!==undefined&&n!==undefined){i=this._formatProgress(t,n)}this._templating.updateSize(e,i)}},_formatProgress:function(e,t){function r(e,t){n=n.replace(e,t)}var n=this._options.text.formatProgress;r("{percent}",Math.round(e/t*100));r("{total_size}",this._formatSize(t));return n},_controlFailureTextDisplay:function(e,t){var n,r,i,s,o;n=this._options.failedUploadTextDisplay.mode;r=this._options.failedUploadTextDisplay.maxChars;i=this._options.failedUploadTextDisplay.responseProperty;if(n==="custom"){s=t[i];if(s){if(s.length>r){o=s.substring(0,r)+"..."}}else{s=this._options.text.failUpload;this.log("'"+i+"' is not a valid property on the server response.","warn")}this._templating.setStatusText(e,o||s);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(e,s)}}else if(n==="default"){this._templating.setStatusText(e,this._options.text.failUpload)}else if(n!=="none"){this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")}},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){this._templating.showCancel(e)}},_itemError:function(e,t,n){var r=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(r)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments);this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}},_fileOrBlobRejected:function(e,t){this._totalFilesInBatch-=1;this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e,t,n){this._totalFilesInBatch=e.length;this._filesInBatchAddedToUi=0;this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var t=this._thumbnailUrls[e];this._templating.updateThumbnail(e,t)},_addCannedFile:function(e){var t=this._parent.prototype._addCannedFile.apply(this,arguments);this._addToList(t,this.getName(t),true);this._templating.hideSpinner(t);this._templating.hideCancel(t);this._markFileAsSuccessful(t);return t}}})();qq.FineUploader=function(e,t){"use strict";this._parent=t?qq[t].FineUploaderBasic:qq.FineUploaderBasic;this._parent.apply(this,arguments);qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[]},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:false,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:false,prependFiles:false},paste:{promptForName:false,namePromptMessage:"Please name this image"},thumbnails:{placeholders:{waitUntilResponse:false,notAvailablePath:null,waitingPath:null}},showMessage:function(e){setTimeout(function(){window.alert(e)},0)},showConfirm:function(e){return window.confirm(e)},showPrompt:function(e,t){return window.prompt(e,t)}},true);qq.extend(this._options,e,true);this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text});if(!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors){this._templating.renderFailure(this._options.messages.unsupportedBrowser)}else{this._wrapCallbacks();this._templating.render();this._classes=this._options.classes;if(!this._options.button&&this._templating.getButton()){this._defaultButtonId=this._createUploadButton({element:this._templating.getButton()}).getButtonId()}this._setupClickAndEditEventHandlers();if(qq.DragAndDrop&&qq.supportedFeatures.fileDrop){this._dnd=this._setupDragAndDrop()}if(this._options.paste.targetElement&&this._options.paste.promptForName){if(qq.PasteSupport){this._setupPastePrompt()}else{qq.log("Paste support module not found.","info")}}this._totalFilesInBatch=0;this._filesInBatchAddedToUi=0}};qq.extend(qq.FineUploader.prototype,qq.basePublicApi);qq.extend(qq.FineUploader.prototype,qq.basePrivateApi);qq.extend(qq.FineUploader.prototype,qq.uiPublicApi);qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi);qq.Templating=function(e){"use strict";function E(){var e,t,n,o,l,c,h,m,g;p("Parsing template");if(a.templateIdOrEl==null){throw new Error("You MUST specify either a template element or ID!")}if(qq.isString(a.templateIdOrEl)){e=document.getElementById(a.templateIdOrEl);if(e===null){throw new Error(qq.format("Cannot find template script at ID '{}'!",a.templateIdOrEl))}t=e.innerHTML}else{if(a.templateIdOrEl.innerHTML===undefined){throw new Error("You have specified an invalid value for the template option!  "+"It must be an ID or an Element.")}t=a.templateIdOrEl.innerHTML}t=qq.trimStr(t);o=document.createElement("div");o.appendChild(qq.toElement(t));if(a.button){c=qq(o).getByClass(f.button)[0];if(c){qq(c).remove()}}if(!qq.DragAndDrop||!qq.supportedFeatures.fileDrop){g=qq(o).getByClass(f.dropProcessing)[0];if(g){qq(g).remove()}}h=qq(o).getByClass(f.drop)[0];if(h&&!qq.DragAndDrop){qq.log("DnD module unavailable.","info");qq(h).remove()}if(h&&!qq.supportedFeatures.fileDrop&&qq(h).hasAttribute(s)){qq(h).css({display:"none"})}m=qq(o).getByClass(f.thumbnail)[0];if(!b){m&&qq(m).remove()}else if(m){u=parseInt(m.getAttribute(r));u=u>0?u:null;w=qq(m).hasAttribute(i)}b=b&&m;d=qq(o).getByClass(f.editFilenameInput).length>0;v=qq(o).getByClass(f.retry).length>0;n=qq(o).getByClass(f.list)[0];if(n==null){throw new Error("Could not find the file list container in the template!")}l=n.innerHTML;n.innerHTML="";p("Template parsing complete");return{template:qq.trimStr(o.innerHTML),fileTemplate:qq.trimStr(l)}}function S(e){return qq(y).getByClass(n+e)[0]}function x(e,t){return qq(e).getByClass(t)[0]}function T(e,t){var n=y,r=n.firstChild;if(t>0){r=qq(n).children()[t].nextSibling}n.insertBefore(e,r)}function N(e){return x(S(e),f.cancel)}function C(e){return x(S(e),f.pause)}function k(e){return x(S(e),f.continueButton)}function L(e){return x(S(e),f.progressBarContainer)||x(S(e),f.progressBar)}function A(e){return x(S(e),f.spinner)}function O(e){return x(S(e),f.editNameIcon)}function M(e){return x(S(e),f.size)}function _(e){return x(S(e),f.deleteButton)}function D(e){return x(S(e),f.retry)}function P(e){return x(S(e),f.file)}function H(){return x(g,f.dropProcessing)}function B(e){return b&&x(S(e),f.thumbnail)}function j(e){e&&qq(e).addClass(a.classes.hide)}function F(e){e&&qq(e).removeClass(a.classes.hide)}function I(e,t){var n=L(e);if(n&&!qq(n).hasClass(f.progressBar)){n=qq(n).getByClass(f.progressBar)[0]}n&&qq(n).css({width:t+"%"})}function q(){var e=a.placeholders.thumbnailNotAvailable,t=a.placeholders.waitingForThumbnail,n={maxSize:u,scale:w};if(b){if(e){a.imageGenerator.generate(e,new Image,n).then(function(e){c.success(e)},function(){c.failure();p("Problem loading 'not available' placeholder image at "+e,"error")})}else{c.failure()}if(t){a.imageGenerator.generate(t,new Image,n).then(function(e){h.success(e)},function(){h.failure();p("Problem loading 'waiting for thumbnail' placeholder image at "+t,"error")})}else{h.failure()}}}function R(e){h.then(function(t){z(t,e);if(e.getAttribute("src")==null){e.src=t.src;F(e)}},function(){j(e)})}function U(e,t){var n=l[e]||(new qq.Promise).failure();c.then(function(r){n.then(function(){delete l[e]},function(){z(r,t);t.src=r.src;F(t);delete l[e]})})}function z(e,t){var n=e.style.maxWidth,r=e.style.maxHeight;if(r&&n&&!t.style.maxWidth&&!t.style.maxHeight){qq(t).css({maxWidth:n,maxHeight:r})}}var t="qq-file-id",n="qq-file-id-",r="qq-max-size",i="qq-server-scale",s="qq-hide-dropzone",o=false,u=-1,a={log:null,templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:false,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},f={button:"qq-upload-button-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},l={},c=new qq.Promise,h=new qq.Promise,p,d,v,m,g,y,b,w;qq.extend(a,e);p=a.log;g=a.containerEl;b=a.imageGenerator!==undefined;m=E();q();qq.extend(this,{render:function(){p("Rendering template in DOM.");g.innerHTML=m.template;j(H());y=a.fileContainerEl||x(g,f.list);p("Template rendering complete")},renderFailure:function(e){var t=qq.toElement(e);g.innerHTML="";g.appendChild(t)},reset:function(){this.render()},clearFiles:function(){y.innerHTML=""},disableCancel:function(){o=true},addFile:function(e,r,i){var s=qq.toElement(m.fileTemplate),u=x(s,f.file);qq(s).addClass(n+e);u&&qq(u).setText(r);s.setAttribute(t,e);if(i){T(s,i.index)}else{y.appendChild(s)}j(L(e));j(M(e));j(_(e));j(D(e));j(C(e));j(k(e));if(o){this.hideCancel(e)}},removeFile:function(e){qq(S(e)).remove()},getFileId:function(e){var n=e;if(n){while(n.getAttribute(t)==null){n=n.parentNode}return parseInt(n.getAttribute(t))}},getFileList:function(){return y},markFilenameEditable:function(e){var t=P(e);t&&qq(t).addClass(a.classes.editable)},updateFilename:function(e,t){var n=P(e);n&&qq(n).setText(t)},hideFilename:function(e){j(P(e))},showFilename:function(e){F(P(e))},isFileName:function(e){return qq(e).hasClass(f.file)},getButton:function(){return a.button||x(g,f.button)},hideDropProcessing:function(){j(H())},showDropProcessing:function(){F(H())},getDropZone:function(){return x(g,f.drop)},isEditFilenamePossible:function(){return d},isRetryPossible:function(){return v},getFileContainer:function(e){return S(e)},showEditIcon:function(e){var t=O(e);t&&qq(t).addClass(a.classes.editable)},hideEditIcon:function(e){var t=O(e);t&&qq(t).removeClass(a.classes.editable)},isEditIcon:function(e){return qq(e).hasClass(f.editNameIcon)},getEditInput:function(e){return x(S(e),f.editFilenameInput)},isEditInput:function(e){return qq(e).hasClass(f.editFilenameInput)},updateProgress:function(e,t,n){var r=L(e),i;if(r){i=Math.round(t/n*100);if(t===n){j(r)}else{F(r)}I(e,i)}},hideProgress:function(e){var t=L(e);t&&j(t)},resetProgress:function(e){I(e,0)},showCancel:function(e){if(!o){var t=N(e);t&&qq(t).removeClass(a.classes.hide)}},hideCancel:function(e){j(N(e))},isCancel:function(e){return qq(e).hasClass(f.cancel)},allowPause:function(e){F(C(e));j(k(e))},uploadPaused:function(e){this.setStatusText(e,a.text.paused);this.allowContinueButton(e);j(A(e))},hidePause:function(e){j(C(e))},isPause:function(e){return qq(e).hasClass(f.pause)},isContinueButton:function(e){return qq(e).hasClass(f.continueButton)},allowContinueButton:function(e){F(k(e));j(C(e))},uploadContinued:function(e){this.setStatusText(e,"");this.allowPause(e);F(A(e))},showDeleteButton:function(e){F(_(e))},hideDeleteButton:function(e){j(_(e))},isDeleteButton:function(e){return qq(e).hasClass(f.deleteButton)},isRetry:function(e){return qq(e).hasClass(f.retry)},updateSize:function(e,t){var n=M(e);if(n){F(n);qq(n).setText(t)}},setStatusText:function(e,t){var n=x(S(e),f.statusText);if(n){if(t==null){qq(n).clearText()}else{qq(n).setText(t)}}},hideSpinner:function(e){j(A(e))},showSpinner:function(e){F(A(e))},generatePreview:function(e,t){var n=B(e),r={maxSize:u,scale:true,orient:true};if(qq.supportedFeatures.imagePreviews){l[e]=new qq.Promise;if(n){R(n);return a.imageGenerator.generate(t,n,r).then(function(){F(n);l[e].success()},function(){l[e].failure();if(!a.placeholders.waitUntilUpdate){U(e,n)}})}}else if(n){R(n)}},updateThumbnail:function(e,t,n){var r=B(e),i={maxSize:u,scale:w};if(r){if(t){if(n){R(r)}return a.imageGenerator.generate(t,r,i).then(function(){F(r)},function(){U(e,r)})}else{U(e,r)}}}})};qq.UploadHandlerForm=function(e,t){"use strict";function f(e,t){var r;try{var i=t.contentDocument||t.contentWindow.document,s=i.body.innerHTML;a("converting iframe's innerHTML to JSON");a("innerHTML = "+s);if(s&&s.match(/^<pre/i)){s=i.body.firstChild.firstChild.nodeValue}r=n._parseJsonResponse(e,s)}catch(o){a("Error when attempting to parse form upload response ("+o.message+")","error");r={success:false}}return r}function l(t,r){var i=e.paramsStore.get(t),u=e.demoMode?"GET":"POST",a=e.endpointStore.get(t),f=s(t);i[e.uuidName]=o(t);i[e.filenameParam]=f;return n._initFormForUpload({method:u,endpoint:a,params:i,paramsInBody:e.paramsInBody,targetName:r.name})}var n=this,r=t.onUploadComplete,i=t.onUuidChanged,s=t.getName,o=t.getUuid,u=r,a=t.log;qq.extend(this,new qq.AbstractUploadHandlerForm({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,onUuidChanged:i,getName:s,getUuid:o,log:a}}));qq.extend(this,{upload:function(t){var r=n._getFileState(t).input,i=s(t),o=n._createIframe(t),c;if(!r){throw new Error("file with passed id was not added, or already uploaded or canceled")}e.onUpload(t,s(t));c=l(t,o);c.appendChild(r);n._attachLoadEvent(o,function(r){a("iframe loaded");var s=r?r:f(t,o);n._detachLoadEvent(t);if(!e.cors.expected){qq(o).remove()}if(!s.success){if(e.onAutoRetry(t,i,s)){return}}e.onComplete(t,i,s);u(t)});a("Sending upload request for "+t);c.submit();qq(c).remove()}})};qq.UploadHandlerXhr=function(e,t){"use strict";function d(){if(e.resume.id!==null&&e.resume.id!==undefined&&!qq.isFunction(e.resume.id)&&!qq.isObject(e.resume.id)){return e.resume.id}}function v(t,n,r){var s=o(t),u=i(t);n[e.chunking.paramNames.partIndex]=r.part;n[e.chunking.paramNames.partByteOffset]=r.start;n[e.chunking.paramNames.chunkSize]=r.size;n[e.chunking.paramNames.totalParts]=r.count;n[e.totalFileSizeName]=s;if(c){n[e.filenameParam]=u}}function m(t){t[e.resume.paramNames.resuming]=true}function g(e,t,n){if(e.slice){return e.slice(t,n)}else if(e.mozSlice){return e.mozSlice(t,n)}else if(e.webkitSlice){return e.webkitSlice(t,n)}}function y(t,n,r,u){var a=new FormData,f=e.demoMode?"GET":"POST",l=e.endpointStore.get(u),h=l,p=i(u),d=o(u);t[e.uuidName]=s(u);t[e.filenameParam]=p;if(c){t[e.totalFileSizeName]=d}if(!e.paramsInBody){if(!c){t[e.inputName]=p}h=qq.obj2url(t,l)}n.open(f,h,true);if(e.cors.expected&&e.cors.sendCredentials){n.withCredentials=true}if(c){if(e.paramsInBody){qq.obj2FormData(t,a)}a.append(e.inputName,r);return a}return r}function b(t,n){var r=e.customHeaders,i=h._getFileState(t).file||h._getFileState(t).blobData.blob;n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.setRequestHeader("Cache-Control","no-cache");if(!c){n.setRequestHeader("Content-Type","application/octet-stream");n.setRequestHeader("X-Mime-Type",i.type)}qq.each(r,function(e,t){n.setRequestHeader(e,t)})}function w(t,r,s){var u=i(t),a=o(t);h._getFileState(t).attemptingResume=false;e.onProgress(t,u,a,a);e.onComplete(t,u,r,s);if(h._getFileState(t)){delete h._getFileState(t).xhr}n(t)}function E(t){var n=h._getFileState(t).remainingChunkIdxs[0],r=h._getChunkData(t,n),s=h._createXhr(t),a=o(t),f=i(t),c,p;if(h._getFileState(t).loaded===undefined){h._getFileState(t).loaded=0}if(l&&h._getFileState(t).file){_(t,r)}s.onreadystatechange=M(t,s);s.upload.onprogress=function(r){if(r.lengthComputable){var i=r.loaded+h._getFileState(t).loaded,s=S(t,n,r.total);e.onProgress(t,f,i,s)}};e.onUploadChunk(t,f,h._getChunkDataForCallback(r));p=e.paramsStore.get(t);v(t,p,r);if(h._getFileState(t).attemptingResume){m(p)}c=y(p,s,r.blob,t);b(t,s);u("Sending chunked upload request for item "+t+": bytes "+(r.start+1)+"-"+r.end+" of "+a);s.send(c)}function S(e,t,n){var r=h._getChunkData(e,t),i=r.size,s=n-i,u=o(e),a=r.count,f=h._getFileState(e).initialRequestOverhead,l=s-f;h._getFileState(e).lastRequestOverhead=s;if(t===0){h._getFileState(e).lastChunkIdxProgress=0;h._getFileState(e).initialRequestOverhead=s;h._getFileState(e).estTotalRequestsSize=u+a*s}else if(h._getFileState(e).lastChunkIdxProgress!==t){h._getFileState(e).lastChunkIdxProgress=t;h._getFileState(e).estTotalRequestsSize+=l}return h._getFileState(e).estTotalRequestsSize}function x(e){if(c){return h._getFileState(e).lastRequestOverhead}else{return 0}}function T(t,n,r){var i=h._getFileState(t).remainingChunkIdxs.shift(),s=h._getChunkData(t,i);h._getFileState(t).attemptingResume=false;h._getFileState(t).loaded+=s.size+x(t);e.onUploadChunkSuccess(t,h._getChunkDataForCallback(s),n,r);if(h._getFileState(t).remainingChunkIdxs.length>0){E(t)}else{if(l){D(t)}w(t,n,r)}}function N(e,t){return e.status!==200||!t.success||t.reset}function C(e,t){var n;try{u(qq.format("Received response status {} with body: {}",t.status,t.responseText));n=qq.parseJson(t.responseText);if(n.newUuid!==undefined){r(e,n.newUuid)}}catch(i){u("Error when attempting to parse xhr response text ("+i.message+")","error");n={}}return n}function k(e){u("Server has ordered chunking effort to be restarted on next attempt for item ID "+e,"error");if(l){D(e);h._getFileState(e).attemptingResume=false}h._getFileState(e).remainingChunkIdxs=[];delete h._getFileState(e).loaded;delete h._getFileState(e).estTotalRequestsSize;delete h._getFileState(e).initialRequestOverhead}function L(e){h._getFileState(e).attemptingResume=false;u("Server has declared that it cannot handle resume for item ID "+e+" - starting from the first chunk","error");k(e);h.upload(e,true)}function A(t,n,r){var s=i(t);if(e.onAutoRetry(t,s,n,r)){return}else{if(r.status!==200){n.success=false}w(t,n,r)}}function O(e,t){var n=h._getFileState(e),r=n&&n.attemptingResume,i=n&&n.paused,s;if(!n||i){return}u("xhr - server response received for "+e);u("responseText = "+t.responseText);s=C(e,t);if(N(t,s)){if(s.reset){k(e)}if(r&&s.reset){L(e)}else{A(e,s,t)}}else if(f){T(e,s,t)}else{w(e,s,t)}}function M(e,t){return function(){if(t.readyState===4){O(e,t)}}}function _(t,n){var r=s(t),i=h._getFileState(t).loaded,o=h._getFileState(t).initialRequestOverhead,u=h._getFileState(t).estTotalRequestsSize,f=H(t),l=r+a+n.part+a+i+a+o+a+u,c=e.resume.cookiesExpireIn;qq.setCookie(f,l,c)}function D(e){if(h._getFileState(e).file){var t=H(e);qq.deleteCookie(t)}}function P(e){var t=qq.getCookie(H(e)),n=i(e),r,s,o,f,l,c;if(t){r=t.split(a);if(r.length===5){s=r[0];o=parseInt(r[1],10);f=parseInt(r[2],10);l=parseInt(r[3],10);c=parseInt(r[4],10);return{uuid:s,part:o,lastByteSent:f,initialRequestOverhead:l,estTotalRequestsSize:c}}else{u("Ignoring previously stored resume/chunk cookie for "+n+" - old cookie format","warn")}}}function H(t){var n=i(t),r=o(t),s=e.chunking.partSize,u;u="qqfilechunk"+a+encodeURIComponent(n)+a+r+a+s;if(p!==undefined){u+=a+p}return u}function B(e,t){var n;for(n=h._getTotalChunks(e)-1;n>=t;n-=1){h._getFileState(e).remainingChunkIdxs.unshift(n)}E(e)}function j(e,t,n,r){n=r.part;h._getFileState(e).loaded=r.lastByteSent;h._getFileState(e).estTotalRequestsSize=r.estTotalRequestsSize;h._getFileState(e).initialRequestOverhead=r.initialRequestOverhead;h._getFileState(e).attemptingResume=true;u("Resuming "+t+" at partition index "+n);B(e,n)}function F(t,n,r){var s=i(t),o=h._getChunkData(t,n.part),a;a=e.onResume(t,s,h._getChunkDataForCallback(o));if(a instanceof qq.Promise){u("Waiting for onResume promise to be fulfilled for "+t);a.then(function(){j(t,s,r,n)},function(){u("onResume promise fulfilled - failure indicated.  Will not resume.");B(t,r)})}else if(a!==false){j(t,s,r,n)}else{u("onResume callback returned false.  Will not resume.");B(t,r)}}function I(e,t){var n=0,r;if(!h._getFileState(e).remainingChunkIdxs||h._getFileState(e).remainingChunkIdxs.length===0){h._getFileState(e).remainingChunkIdxs=[];if(l&&!t&&h._getFileState(e).file){r=P(e);if(r){F(e,r,n)}else{B(e,n)}}else{B(e,n)}}else{E(e)}}function q(t){var n=h._getFileState(t).file||h._getFileState(t).blobData.blob,r=i(t),s,o,a;h._getFileState(t).loaded=0;s=h._createXhr(t);s.upload.onprogress=function(n){if(n.lengthComputable){h._getFileState(t).loaded=n.loaded;e.onProgress(t,r,n.loaded,n.total)}};s.onreadystatechange=M(t,s);o=e.paramsStore.get(t);a=y(o,s,n,t);b(t,s);u("Sending upload request for "+t);s.send(a)}function R(t,n){var r=i(t);if(h.isValid(t)){e.onUpload(t,r);if(f){I(t,n)}else{q(t)}}}var n=t.onUploadComplete,r=t.onUuidChanged,i=t.getName,s=t.getUuid,o=t.getSize,u=t.log,a="|",f=e.chunking.enabled&&qq.supportedFeatures.chunking,l=e.resume.enabled&&f&&qq.supportedFeatures.resume,c=e.forceMultipart||e.paramsInBody,h=this,p;p=d();qq.extend(this,new qq.AbstractUploadHandlerXhr({options:{chunking:f?e.chunking:null},proxy:{onUpload:R,onCancel:e.onCancel,onUuidChanged:r,getName:i,getSize:o,getUuid:s,log:u}}));qq.override(this,function(t){return{add:function(e,n){var i;t.add.apply(this,arguments);if(l){i=P(e);if(i){r(e,i.uuid)}}return e},getResumableFilesData:function(){var t=[],n=[];if(f&&l){if(p===undefined){t=qq.getCookieNames(new RegExp("^qqfilechunk\\"+a+".+\\"+a+"\\d+\\"+a+e.chunking.partSize+"="))}else{t=qq.getCookieNames(new RegExp("^qqfilechunk\\"+a+".+\\"+a+"\\d+\\"+a+e.chunking.partSize+"\\"+a+p+"="))}qq.each(t,function(e,t){var r=t.split(a);var i=qq.getCookie(t).split(a);n.push({name:decodeURIComponent(r[1]),size:r[2],uuid:i[0],partIdx:i[1]})});return n}return[]},expunge:function(e){if(l){D(e)}t.expunge(e)}}})};qq.PasteSupport=function(e){"use strict";function r(e){return e.type&&e.type.indexOf("image/")===0}function i(){qq(t.targetElement).attach("paste",function(e){var n=e.clipboardData;if(n){qq.each(n.items,function(e,n){if(r(n)){var i=n.getAsFile();t.callbacks.pasteReceived(i)}})}})}function s(){if(n){n()}}var t,n;t={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}};qq.extend(t,e);i();qq.extend(this,{reset:function(){s()}})};qq.DragAndDrop=function(e){"use strict";function u(e,n){var r=Array.prototype.slice.call(e);t.callbacks.dropLog("Grabbed "+e.length+" dropped files.");n.dropDisabled(false);t.callbacks.processingDroppedFilesComplete(r,n.getElement())}function a(e){var n,r=new qq.Promise;if(e.isFile){e.file(function(e){s.push(e);r.success()},function(n){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+n.code+".","error");r.failure()})}else if(e.isDirectory){n=e.createReader();n.readEntries(function(e){var t=e.length;qq.each(e,function(e,n){a(n).done(function(){t-=1;if(t===0){r.success()}})});if(!e.length){r.success()}},function(n){t.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+n.code+".","error");r.failure()})}return r}function f(e,n){var r=[],i=new qq.Promise;t.callbacks.processingDroppedFiles();n.dropDisabled(true);if(e.files.length>1&&!t.allowMultipleItems){t.callbacks.processingDroppedFilesComplete([]);t.callbacks.dropError("tooManyFilesError","");n.dropDisabled(false);i.failure()}else{s=[];if(qq.isFolderDropSupported(e)){qq.each(e.items,function(e,t){var n=t.webkitGetAsEntry();if(n){if(n.isFile){s.push(t.getAsFile())}else{r.push(a(n).done(function(){r.pop();if(r.length===0){i.success()}}))}}})}else{s=e.files}if(r.length===0){i.success()}}return i}function l(e){var a=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:n,element:e,onEnter:function(n){qq(e).addClass(t.classes.dropActive);n.stopPropagation()},onLeaveNotDescendants:function(n){qq(e).removeClass(t.classes.dropActive)},onDrop:function(e){f(e.dataTransfer,a).then(function(){u(s,a)},function(){t.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});o.addDisposer(function(){a.dispose()});qq(e).hasAttribute(r)&&qq(e).hide();i.push(a);return a}function c(e){var t;qq.each(e.dataTransfer.types,function(e,n){if(n==="Files"){t=true;return false}});return t}function h(e){return(qq.chrome()||qq.safari()&&qq.windows())&&e.clientX==0&&e.clientY==0||qq.firefox()&&!e.relatedTarget}function p(){var e=t.dropZoneElements;qq.each(e,function(t,n){var r=l(n);if(e.length&&(!qq.ie()||qq.ie10())){o.attach(document,"dragenter",function(t){if(!r.dropDisabled()&&c(t)){qq.each(e,function(e,t){if(t instanceof HTMLElement){qq(t).css({display:"block"})}})}})}});o.attach(document,"dragleave",function(t){if(h(t)){qq.each(e,function(e,t){qq(t).hasAttribute(r)&&qq(t).hide()})}});o.attach(document,"drop",function(t){qq.each(e,function(e,t){qq(t).hasAttribute(r)&&qq(t).hide()});t.preventDefault()});o.attach(document,n,function(e){qq.each(t.dropZoneElements,function(e,n){qq(n).hasAttribute(r)&&qq(n).hide();qq(n).removeClass(t.classes.dropActive)})})}var t,n="qq-hidezones",r="qq-hide-dropzone",i=[],s=[],o=new qq.DisposeSupport;t={dropZoneElements:[],allowMultipleItems:true,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks};qq.extend(t,e,true);p();qq.extend(this,{setupExtraDropzone:function(e){t.dropZoneElements.push(e);l(e)},removeDropzone:function(e){var n,r=t.dropZoneElements;for(n in r){if(r[n]===e){return r.splice(n,1)}}},dispose:function(){o.dispose();qq.each(i,function(e,t){t.dispose()})}})};qq.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,t){qq.log("Drag & drop error code '"+e+" with these specifics: '"+t+"'","error")},dropLog:function(e,t){qq.log(e,t)}}};qq.UploadDropZone=function(e){"use strict";function o(){return qq.safari()||qq.firefox()&&qq.windows()}function u(e){if(!s){if(o){t.attach(document,"dragover",function(e){e.preventDefault()})}else{t.attach(document,"dragover",function(e){if(e.dataTransfer){e.dataTransfer.dropEffect="none";e.preventDefault()}})}s=true}}function a(e){if(qq.ie()&&!qq.ie10()){return false}var t,n=e.dataTransfer,r=qq.safari();t=qq.ie10()||qq.ie11()?true:n.effectAllowed!=="none";return n&&t&&(n.files||!r&&n.types.contains&&n.types.contains("Files"))}function f(e){if(e!==undefined){i=e}return i}function l(){function t(){e=document.createEvent("Event");e.initEvent(n.HIDE_ZONES_EVENT_NAME,true,true)}var e;if(window.CustomEvent){try{e=new CustomEvent(n.HIDE_ZONES_EVENT_NAME)}catch(r){t()}}else{t()}document.dispatchEvent(e)}function c(){t.attach(r,"dragover",function(e){if(!a(e)){return}var t=qq.ie()||qq.ie11()?null:e.dataTransfer.effectAllowed;if(t==="move"||t==="linkMove"){e.dataTransfer.dropEffect="move"}else{e.dataTransfer.dropEffect="copy"}e.stopPropagation();e.preventDefault()});t.attach(r,"dragenter",function(e){if(!f()){if(!a(e)){return}n.onEnter(e)}});t.attach(r,"dragleave",function(e){if(!a(e)){return}n.onLeave(e);var t=document.elementFromPoint(e.clientX,e.clientY);if(qq(this).contains(t)){return}n.onLeaveNotDescendants(e)});t.attach(r,"drop",function(e){if(!f()){if(!a(e)){return}e.preventDefault();e.stopPropagation();n.onDrop(e);l()}})}var t=new qq.DisposeSupport,n,r,i,s;n={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(n,e);r=n.element;u();c();qq.extend(this,{dropDisabled:function(e){return f(e)},dispose:function(){t.dispose()},getElement:function(){return r}})};qq.DeleteFileAjaxRequester=function(e){"use strict";function r(){if(n.method.toUpperCase()==="POST"){return{_method:"DELETE"}}return{}}var t,n={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:false,cors:{expected:false,sendCredentials:false},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};qq.extend(n,e);t=qq.extend(this,new qq.AjaxRequester({validMethods:["POST","DELETE"],method:n.method,endpointStore:n.endpointStore,paramsStore:n.paramsStore,mandatedParams:r(),maxConnections:n.maxConnections,customHeaders:n.customHeaders,demoMode:n.demoMode,log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete,cors:n.cors}));qq.extend(this,{sendDelete:function(e,r,i){var s=i||{};n.log("Submitting delete file request for "+e);if(n.method==="DELETE"){t.initTransport(e).withPath(r).withParams(s).send()}else{s[n.uuidParamName]=r;t.initTransport(e).withParams(s).send()}}})};(function(){function e(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1024*1024){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");i.drawImage(e,-t+1,0);return i.getImageData(0,0,1,1).data[3]===0}else{return false}}function t(e,t,n){var r=document.createElement("canvas");r.width=1;r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);var s=i.getImageData(0,0,1,n).data;var o=0;var u=n;var a=n;while(a>o){var f=s[(a-1)*4+3];if(f===0){u=a}else{o=a}a=u+o>>1}var l=a/n;return l===0?1:l}function n(e,t,n){var i=document.createElement("canvas"),s=t.mime||"image/jpeg";r(e,i,t,n);return i.toDataURL(s,t.quality||.8)}function r(n,r,s,o){var u=n.naturalWidth,a=n.naturalHeight;var f=s.width,l=s.height;var c=r.getContext("2d");c.save();i(r,f,l,s.orientation);if(qq.ios()){var h=e(n);if(h){u/=2;a/=2}var p=1024;var d=document.createElement("canvas");d.width=d.height=p;var v=d.getContext("2d");var m=o?t(n,u,a):1;var g=Math.ceil(p*f/u);var y=Math.ceil(p*l/a/m);var b=0;var w=0;while(b<a){var E=0;var S=0;while(E<u){v.clearRect(0,0,p,p);v.drawImage(n,-E,-b);c.drawImage(d,0,0,p,p,S,w,g,y);E+=p;S+=g}b+=p;w+=y}c.restore();d=v=null}else{c.drawImage(n,0,0,f,l)}}function i(e,t,n,r){switch(r){case 5:case 6:case 7:case 8:e.width=n;e.height=t;break;default:e.width=t;e.height=n}var i=e.getContext("2d");switch(r){case 2:i.translate(t,0);i.scale(-1,1);break;case 3:i.translate(t,n);i.rotate(Math.PI);break;case 4:i.translate(0,n);i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI);i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI);i.translate(0,-n);break;case 7:i.rotate(.5*Math.PI);i.translate(t,-n);i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI);i.translate(-t,0);break;default:break}}function s(e,t){if(window.Blob&&e instanceof Blob){var n=new Image;var r=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!r){throw Error("No createObjectURL function found to create blob url")}n.src=r.createObjectURL(e);this.blob=e;e=n}if(!e.naturalWidth&&!e.naturalHeight){var i=this;e.onload=function(){var e=i.imageLoadListeners;if(e){i.imageLoadListeners=null;for(var t=0,n=e.length;t<n;t++){e[t]()}}};e.onerror=t;this.imageLoadListeners=[]}this.srcImage=e}s.prototype.render=function(e,t){if(this.imageLoadListeners){var i=this;this.imageLoadListeners.push(function(){i.render(e,t)});return}t=t||{};var s=this.srcImage.naturalWidth,o=this.srcImage.naturalHeight,u=t.width,a=t.height,f=t.maxWidth,l=t.maxHeight,c=!this.blob||this.blob.type==="image/jpeg";if(u&&!a){a=o*u/s<<0}else if(a&&!u){u=s*a/o<<0}else{u=s;a=o}if(f&&u>f){u=f;a=o*u/s<<0}if(l&&a>l){a=l;u=s*a/o<<0}var h={width:u,height:a};for(var p in t)h[p]=t[p];var d=e.tagName.toLowerCase();if(d==="img"){e.src=n(this.srcImage,h,c)}else if(d==="canvas"){r(this.srcImage,e,h,c)}if(typeof this.onrender==="function"){this.onrender(e)}};if(typeof define==="function"&&define.amd){define([],function(){return s})}else{this.MegaPixImage=s}})();qq.ImageGenerator=function(e){"use strict";function t(e){return e.tagName.toLowerCase()==="img"}function n(e){return e.tagName.toLowerCase()==="canvas"}function r(){return(new Image).crossOrigin!==undefined}function i(){var e=document.createElement("canvas");return e.getContext&&e.getContext("2d")}function s(e){var t=e.split("/"),n=t[t.length-1],r=qq.getExtension(n);r=r&&r.toLowerCase();switch(r){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function o(e){var t=document.createElement("a"),n,r,i;t.href=e;n=t.protocol;i=t.port;r=t.hostname;if(n.toLowerCase()!==window.location.protocol.toLowerCase()){return true}if(r.toLowerCase()!==window.location.hostname.toLowerCase()){return true}if(i!==window.location.port&&!qq.ie()){return true}return false}function u(t,n){t.onload=function(){t.onload=null;t.onerror=null;n.success(t)};t.onerror=function(){t.onload=null;t.onerror=null;e("Problem drawing thumbnail!","error");n.failure(t,"Problem drawing thumbnail!")}}function a(e,t){var n=e.getContext("2d"),r=n.drawImage;n.drawImage=function(){r.apply(this,arguments);t.success(e);n.drawImage=r}}function f(r,i){var s=t(r)||n(r);if(t(r)){u(r,i)}else if(n(r)){a(r,i)}else{i.failure(r);e(qq.format("Element container of type {} is not supported!",r.tagName),"error")}return s}function l(t,n,r){var i=new qq.Promise,s=new qq.Identify(t,e),o=r.maxSize,u=function(){n.onerror=null;n.onload=null;e("Could not render preview, file may be too large!","error");i.failure(n,"Browser cannot render image!")};s.isPreviewable().then(function(r){var s=new qq.Exif(t,e),a=new MegaPixImage(t,u);if(f(n,i)){s.parse().then(function(e){var t=e.Orientation;a.render(n,{maxWidth:o,maxHeight:o,orientation:t,mime:r})},function(t){e(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",t));a.render(n,{maxWidth:o,maxHeight:o,mime:r})})}},function(){e("Not previewable");i.failure(n,"Not previewable")});return i}function c(e,t,n,r){var i=new Image,u=new qq.Promise;f(i,u);if(o(e)){i.crossOrigin="anonymous"}i.src=e;u.then(function(){f(t,n);var o=new MegaPixImage(i);o.render(t,{maxWidth:r,maxHeight:r,mime:s(e)})})}function h(e,t,n,r){f(t,n);qq(t).css({maxWidth:r+"px",maxHeight:r+"px"});t.src=e}function p(e,s,u){var a=new qq.Promise,l=u.scale,p=l?u.maxSize:null;if(l&&t(s)){if(i()){if(o(e)&&!r()){h(e,s,a,p)}else{c(e,s,a,p)}}else{h(e,s,a,p)}}else if(n(s)){c(e,s,a,p)}else if(f(s,a)){s.src=e}return a}qq.extend(this,{generate:function(t,n,r){if(qq.isString(t)){e("Attempting to update thumbnail based on server response.");return p(t,n,r||{})}else{e("Attempting to draw client-side image preview.");return l(t,n,r||{})}}});this._testing={};this._testing.isImg=t;this._testing.isCanvas=n;this._testing.isCrossOrigin=o;this._testing.determineMimeOfFileName=s};qq.Exif=function(e,t){"use strict";function i(e){var t=0,n=0;while(e.length>0){t+=parseInt(e.substring(0,2),16)*Math.pow(2,n);e=e.substring(2,e.length);n+=8}return t}function s(t,n){var r=t,i=n;if(r===undefined){r=2;i=new qq.Promise}qq.readBlobToHex(e,r,4).then(function(e){var t=/^ffe([0-9])/.exec(e);if(t){if(t[1]!=="1"){var n=parseInt(e.slice(4,8),16);s(r+n+2,i)}else{i.success(r)}}else{i.failure("No EXIF header to be found!")}});return i}function o(){var t=new qq.Promise;qq.readBlobToHex(e,0,6).then(function(e){if(e.indexOf("ffd8")!==0){t.failure("Not a valid JPEG!")}else{s().then(function(e){t.success(e)},function(e){t.failure(e)})}});return t}function u(t){var n=new qq.Promise;qq.readBlobToHex(e,t+10,2).then(function(e){n.success(e==="4949")});return n}function a(t,n){var r=new qq.Promise;qq.readBlobToHex(e,t+18,2).then(function(e){if(n){return r.success(i(e))}else{r.success(parseInt(e,16))}});return r}function f(t,n){var r=t+20,i=n*12;return qq.readBlobToHex(e,r,i)}function l(e){var t=[],n=0;while(n+24<=e.length){t.push(e.slice(n,n+24));n+=24}return t}function c(e,t){var s=16,o=qq.extend([],n),u={};qq.each(t,function(t,n){var a=n.slice(0,4),f=e?i(a):parseInt(a,16),l=o.indexOf(f),c,h,p;if(l>=0){h=r[f].name;p=r[f].bytes;c=n.slice(s,s+p*2);u[h]=e?i(c):parseInt(c,16);o.splice(l,1)}if(o.length===0){return false}});return u}var n=[274],r={274:{name:"Orientation",bytes:2}};qq.extend(this,{parse:function(){var n=new qq.Promise,r=function(e){t(qq.format("EXIF header parse failed: '{}' ",e));n.failure(e)};o().then(function(i){t(qq.format("Moving forward with EXIF header parsing for '{}'",e.name===undefined?"blob":e.name));u(i).then(function(e){t(qq.format("EXIF Byte order is {} endian",e?"little":"big"));a(i,e).then(function(s){t(qq.format("Found {} APP1 directory entries",s));f(i,s).then(function(r){var i=l(r),s=c(e,i);t("Successfully parsed some EXIF tags");n.success(s)},r)},r)},r)},r);return n}});this._testing={};this._testing.parseLittleEndian=i};qq.Identify=function(e,t){"use strict";function r(e,t){var n=false,r=[].concat(e);qq.each(r,function(e,r){if(t.indexOf(r)===0){n=true;return false}});return n}var n={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]};qq.extend(this,{isPreviewable:function(){var i=new qq.Promise,s=false,o=e.name===undefined?"blob":e.name;t(qq.format("Attempting to determine if {} can be rendered in this browser",o));qq.readBlobToHex(e,0,4).then(function(e){qq.each(n,function(t,n){if(r(n,e)){if(t!=="image/tiff"||qq.safari()){s=true;i.success(t)}return false}});t(qq.format("'{}' is {} able to be rendered in this browser",o,s?"":"NOT"));if(!s){i.failure()}});return i}})};qq.ImageValidation=function(e,t){"use strict";function n(e){var t=false;qq.each(e,function(e,n){if(n>0){t=true;return false}});return t}function r(){var n=new qq.Promise;(new qq.Identify(e,t)).isPreviewable().then(function(){var r=new Image,i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(i){r.onerror=function(){t("Cannot determine dimensions for image.  May be too large.","error");n.failure()};r.onload=function(){n.success({width:this.width,height:this.height})};r.src=i.createObjectURL(e)}else{t("No createObjectURL function available to generate image URL!","error");n.failure()}},n.failure);return n}function i(e,t){var n;qq.each(e,function(e,r){if(r>0){var i=/(max|min)(Width|Height)/.exec(e),s=i[2].charAt(0).toLowerCase()+i[2].slice(1),o=t[s];switch(i[1]){case"min":if(o<r){n=e;return false}break;case"max":if(o>r){n=e;return false}break}}});return n}this.validate=function(e){var s=new qq.Promise;t("Attempting to validate image.");if(n(e)){r().then(function(t){var n=i(e,t);if(n){s.failure(n)}else{s.success()}},s.success)}else{s.success()}return s}};qq.Session=function(e){"use strict";function n(e){if(qq.isArray(e)){return true}t.log("Session response is not an array.","error")}function r(e,r,i,s){var o=false;r=r&&n(e);if(r){qq.each(e,function(e,n){if(n.uuid==null){o=true;t.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",e),"error")}else if(n.name==null){o=true;t.log(qq.format("Session response item {} did not include a valid name - ignoring.",e),"error")}else{try{t.addFileRecord(n);return true}catch(r){o=true;t.log(r.message,"error")}}return false})}s[r&&!o?"success":"failure"](e,i)}var t={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};qq.extend(t,e,true);this.refresh=function(){var e=new qq.Promise,n=function(t,n,i){r(t,n,i,e)},i=qq.extend({},t),s=new qq.SessionAjaxRequester(qq.extend(i,{onComplete:n}));s.queryServer();return e}};qq.SessionAjaxRequester=function(e){"use strict";function r(e,t,r){var i=null;if(t.responseText!=null){try{i=qq.parseJson(t.responseText)}catch(s){n.log("Problem parsing session response: "+s.message,"error");r=true}}n.onComplete(i,!r,t)}var t,n={endpoint:null,customHeaders:{},params:{},cors:{expected:false,sendCredentials:false},onComplete:function(e,t,n){},log:function(e,t){}};qq.extend(n,e);t=qq.extend(this,new qq.AjaxRequester({validMethods:["GET"],method:"GET",endpointStore:{get:function(){return n.endpoint}},customHeaders:n.customHeaders,log:n.log,onComplete:r,cors:n.cors}));qq.extend(this,{queryServer:function(){var e=qq.extend({},n.params);n.log("Session query request.");t.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})};qq.FormSupport=function(e,t,n){"use strict";function u(e){if(e.getAttribute("action")){r.newEndpoint=e.getAttribute("action")}}function a(e,t){if(e.checkValidity&&!e.checkValidity()){n("Form did not pass validation checks - will not upload.","error");t()}else{return true}}function f(e){var n=e.submit;qq(e).attach("submit",function(r){r=r||window.event;if(r.preventDefault){r.preventDefault()}else{r.returnValue=false}a(e,n)&&t()});e.submit=function(){a(e,n)&&t()}}function l(e){if(e){if(qq.isString(e)){e=document.getElementById(e)}if(e){n("Attaching to form element.");u(e);i&&f(e)}}return e}var r=this,i=e.interceptSubmit,s=e.element,o=e.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:o,attachedToForm:false,getFormInputsAsObject:function(){if(s==null){return null}return r._form2Obj(s)}});s=l(s);this.attachedToForm=!!s};qq.extend(qq.FormSupport.prototype,{_form2Obj:function(e){"use strict";var t={},n=function(e){var t=["button","image","reset","submit"];return qq.indexOf(t,e.toLowerCase())<0},r=function(e){return qq.indexOf(["checkbox","radio"],e.toLowerCase())>=0},i=function(e){if(r(e.type)&&!e.checked){return true}return e.disabled&&e.type.toLowerCase()!=="hidden"},s=function(e){var t=null;qq.each(qq(e).children(),function(e,n){if(n.tagName.toLowerCase()==="option"&&n.selected){t=n.value;return false}});return t};qq.each(e.elements,function(e,r){if(qq.isInput(r,true)&&n(r.type)&&!i(r)){t[r.name]=r.value}else if(r.tagName.toLowerCase()==="select"&&!i(r)){var o=s(r);if(o!==null){t[r.name]=o}}});return t}});qq.UiEventHandler=function(e,t){"use strict";function i(e){n.attach(e,r.eventType,function(e){e=e||window.event;var t=e.target||e.srcElement;r.onHandled(t,e)})}var n=new qq.DisposeSupport,r={eventType:"click",attachTo:null,onHandled:function(e,t){}};qq.extend(this,{addHandler:function(e){i(e)},dispose:function(){n.dispose()}});qq.extend(t,{getFileIdFromItem:function(e){return e.qqFileId},getDisposeSupport:function(){return n}});qq.extend(r,e);if(r.attachTo){i(r.attachTo)}};qq.FileButtonsClickHandler=function(e){"use strict";function i(e,t){qq.each(r,function(r,i){var s=r.charAt(0).toUpperCase()+r.slice(1),o;if(n.templating["is"+s](e)){o=n.templating.getFileId(e);qq.preventDefault(t);n.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",n.onGetName(o),o));i(o);return false}})}var t={},n={templating:null,log:function(e,t){},onDeleteFile:function(e){},onCancel:function(e){},onRetry:function(e){},onPause:function(e){},onContinue:function(e){},onGetName:function(e){}},r={cancel:function(e){n.onCancel(e)},retry:function(e){n.onRetry(e)},deleteButton:function(e){n.onDeleteFile(e)},pause:function(e){n.onPause(e)},continueButton:function(e){n.onContinue(e)}};qq.extend(n,e);n.eventType="click";n.onHandled=i;n.attachTo=n.templating.getFileList();qq.extend(this,new qq.UiEventHandler(n,t))};qq.FilenameClickHandler=function(e){"use strict";function r(e,r){if(n.templating.isFileName(e)||n.templating.isEditIcon(e)){var i=n.templating.getFileId(e),s=n.onGetUploadStatus(i);if(s===qq.status.SUBMITTED){n.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",n.onGetName(i),i));qq.preventDefault(r);t.handleFilenameEdit(i,e,true)}}}var t={},n={templating:null,log:function(e,t){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(e){},onGetName:function(e){}};qq.extend(n,e);n.eventType="click";n.onHandled=r;qq.extend(this,new qq.FilenameEditHandler(n,t))};qq.FilenameInputFocusInHandler=function(e,t){"use strict";function r(e,r){if(n.templating.isEditInput(e)){var i=n.templating.getFileId(e),s=n.onGetUploadStatus(i);if(s===qq.status.SUBMITTED){n.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",n.onGetName(i),i));t.handleFilenameEdit(i,e)}}}var n={templating:null,onGetUploadStatus:function(e){},log:function(e,t){}};if(!t){t={}}n.eventType="focusin";n.onHandled=r;qq.extend(n,e);qq.extend(this,new qq.FilenameEditHandler(n,t))};qq.FilenameInputFocusHandler=function(e){"use strict";e.eventType="focus";e.attachTo=null;qq.extend(this,new qq.FilenameInputFocusInHandler(e,{}))};qq.FilenameEditHandler=function(e,t){"use strict";function r(e){var t=n.onGetName(e),r=t.lastIndexOf(".");if(r>0){t=t.substr(0,r)}return t}function i(e){var t=n.onGetName(e);return qq.getExtension(t)}function s(e,t){var r=e.value,s;if(r!==undefined&&qq.trimStr(r).length>0){s=i(t);if(s!==undefined){r=r+"."+s}n.onSetName(t,r)}n.onEditingStatusChange(t,false)}function o(e,n){t.getDisposeSupport().attach(e,"blur",function(){s(e,n)})}function u(e,n){t.getDisposeSupport().attach(e,"keyup",function(t){var r=t.keyCode||t.which;if(r===13){s(e,n)}})}var n={templating:null,log:function(e,t){},onGetUploadStatus:function(e){},onGetName:function(e){},onSetName:function(e,t){},onEditingStatusChange:function(e,t){}};qq.extend(n,e);n.attachTo=n.templating.getFileList();qq.extend(this,new qq.UiEventHandler(n,t));qq.extend(t,{handleFilenameEdit:function(e,t,i){var s=n.templating.getEditInput(e);n.onEditingStatusChange(e,true);s.value=r(e);if(i){s.focus()}o(s,e);u(s,e)}})};(function(e){"use strict";function r(e){var n=f(e||{}),r=i(n);o(r);a(n,r);return t}function i(e){var t=u("uploaderType"),n=u("endpointType");if(t){t=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();if(n){return new qq[n]["FineUploader"+t](e)}return new qq["FineUploader"+t](e)}else{if(n){return new qq[n].FineUploader(e)}return new qq.FineUploader(e)}}function s(e,n){var r=t.data("fineuploader");if(n){if(r===undefined){r={}}r[e]=n;t.data("fineuploader",r)}else{if(r===undefined){return null}return r[e]}}function o(e){return s("uploader",e)}function u(e,t){return s(e,t)}function a(n,r){var i=n.callbacks={};e.each(r._options.callbacks,function(n,r){var s,o;s=/^on(\w+)/.exec(n)[1];s=s.substring(0,1).toLowerCase()+s.substring(1);o=t;i[n]=function(){var t=Array.prototype.slice.call(arguments),n=[],i,u;e.each(t,function(e,t){n.push(h(t))});i=r.apply(this,t);try{u=o.triggerHandler(s,n)}catch(a){qq.log("Caught error in Fine Uploader jQuery event handler: "+a.message,"error")}if(i!=null){return i}return u}});r._options.callbacks=i}function f(r,i){var s,o;if(i===undefined){if(r.uploaderType!=="basic"){s={element:t[0]}}else{s={}}}else{s=i}e.each(r,function(t,r){if(e.inArray(t,n)>=0){u(t,r)}else if(r instanceof e){s[t]=r[0]}else if(e.isPlainObject(r)){s[t]={};f(r,s[t])}else if(e.isArray(r)){o=[];e.each(r,function(t,n){var r={};if(n instanceof e){e.merge(o,n)}else if(e.isPlainObject(n)){f(n,r);o.push(r)}else{o.push(n)}});s[t]=o}else{s[t]=r}});if(i===undefined){return s}}function l(t){return e.type(t)==="string"&&!t.match(/^_/)&&o()[t]!==undefined}function c(e){var t=[],n=Array.prototype.slice.call(arguments,1),r;f(n,t);r=o()[e].apply(o(),t);return h(r)}function h(t){var n=t;if(t!=null&&typeof t==="object"&&(t.nodeType===1||t.nodeType===9)&&t.cloneNode){n=e(t)}return n}var t,n=["uploaderType","endpointType"];e.fn.fineUploader=function(n){var i=this,s=arguments,u=[];this.each(function(a,f){t=e(f);if(o()&&l(n)){u.push(c.apply(i,s));if(i.length===1){return false}}else if(typeof n==="object"||!n){r.apply(i,s)}else{e.error("Method "+n+" does not exist on jQuery.fineUploader")}});if(u.length===1){return u[0]}else if(u.length>1){return u}return this}})(jQuery);(function(e){"use strict";function r(e){if(!e){e={}}e.dropZoneElements=[n];var t=u(e);o(t);s(new qq.DragAndDrop(t));return n}function i(e,r){var i=n.data(t);if(r){if(i===undefined){i={}}i[e]=r;n.data(t,i)}else{if(i===undefined){return null}return i[e]}}function s(e){return i("dndInstance",e)}function o(t){var r=t.callbacks={},i=new qq.FineUploaderBasic;e.each(new qq.DragAndDrop.callbacks,function(e,t){var i=e,s;s=n;r[e]=function(){var e=Array.prototype.slice.call(arguments),t=s.triggerHandler(i,e);return t}})}function u(t,n){var r,i;if(n===undefined){r={}}else{r=n}e.each(t,function(t,n){if(n instanceof e){r[t]=n[0]}else if(e.isPlainObject(n)){r[t]={};u(n,r[t])}else if(e.isArray(n)){i=[];e.each(n,function(t,n){if(n instanceof e){e.merge(i,n)}else{i.push(n)}});r[t]=i}else{r[t]=n}});if(n===undefined){return r}}function a(t){return e.type(t)==="string"&&t==="dispose"&&s()[t]!==undefined}function f(e){var t=[],n=Array.prototype.slice.call(arguments,1);u(n,t);return s()[e].apply(s(),t)}var t="fineUploaderDnd",n;e.fn.fineUploaderDnd=function(t){var i=this,o=arguments,u=[];this.each(function(l,c){n=e(c);if(s()&&a(t)){u.push(f.apply(i,o));if(i.length===1){return false}}else if(typeof t==="object"||!t){r.apply(i,o)}else{e.error("Method "+t+" does not exist in Fine Uploader's DnD module.")}});if(u.length===1){return u[0]}else if(u.length>1){return u}return this}})(jQuery)